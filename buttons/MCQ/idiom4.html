<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Sniper Duel: IS vs ARE ğŸ¯</title>

<style>
body{
  margin:0;
  font-family:'Segoe UI',Tahoma,Verdana,sans-serif;
  background:radial-gradient(circle at bottom,#05060f,#000);
  color:#fff;
  text-align:center;
  overflow:hidden;
}

.container{
  max-width:900px;
  margin:2rem auto;
  padding:2rem;
  background:rgba(255,255,255,0.05);
  border-radius:18px;
  box-shadow:0 0 40px rgba(0,255,255,0.15);
}

.quiz-header-bar{
  display:none;
  background:#0b1025;
  padding:.6rem 1rem;
}

.quiz-header-content{
  display:flex;
  justify-content:space-between;
  font-weight:bold;
  color:#ffd700;
}

#sentenceFlash{
  font-size:1.8rem;
  margin:2.5rem 0;
  padding:1.5rem;
  border-radius:12px;
  background:rgba(0,0,0,0.4);
}

.sniper-zone{
  display:flex;
  justify-content:space-between;
  gap:2rem;
  margin-top:3rem;
}

.sniper{
  flex:1;
  padding:2rem;
  font-size:2rem;
  border-radius:16px;
  cursor:pointer;
  transition:.2s;
}

.sniper.is{background:#0077ff;}
.sniper.are{background:#ff0066;}

#nameForm select,#nameForm input,#nameForm button{
  width:90%;
  max-width:320px;
  padding:.8rem;
  margin:.6rem auto;
  border-radius:8px;
  border:none;
}

#nameForm button{
  background:#ffd700;
  font-weight:bold;
}
</style>
</head>

<body>

<div class="quiz-header-bar" id="quizHeaderBar">
  <div class="quiz-header-content">
    <div>â³ <span id="time-value">0</span>s</div>
    <div>ğŸ’ <span id="gem-value">0</span></div>
    <div>ğŸ”¥ <span id="streak-value">0</span></div>
    <div>ğŸ¯ <span id="current-question">1</span>/<span id="total-questions">0</span></div>
  </div>
</div>

<div class="container">

<div id="nameForm">
  <p style="color:#ffd700">Grammar Duel Mission ğŸš€</p>
  <select id="departmentSelect">
    <option value="">-- Select Department --</option>
    <option>Cyber Security</option>
    <option>CSE-1</option>
    <option>CSE-2</option>
    <option>CSE-3</option>
option>EIE</option
  </select>
  <input type="text" id="nameInput" placeholder="Enter your name">
  <button id="startQuizBtn">ğŸš€ Launch Mission</button>
</div>

<div id="quizContent" style="display:none">
  <div id="sentenceFlash">Loadingâ€¦</div>

  <div class="sniper-zone">
    <div class="sniper is" id="sniperIs">IS</div>
    <div class="sniper are" id="sniperAre">ARE</div>
  </div>

  <div id="scoreCard"></div>
  <button id="restartBtn" style="display:none">Restart</button>
</div>

</div>

<script>
"use strict";

/* ===== DOM REFERENCES ===== */
const nameForm = document.getElementById("nameForm");
const quizContent = document.getElementById("quizContent");
const quizHeaderBar = document.getElementById("quizHeaderBar");

const sentenceFlash = document.getElementById("sentenceFlash");
const gemValue = document.getElementById("gem-value");
const streakValue = document.getElementById("streak-value");
const currentQ = document.getElementById("current-question");
const totalQ = document.getElementById("total-questions");
const timeValue = document.getElementById("time-value");
const scoreCard = document.getElementById("scoreCard");
const restartBtn = document.getElementById("restartBtn");

/* ===== LOCAL STORAGE AUTOFILL ===== */
(function(){
  const n = localStorage.getItem("playerName");
  const d = localStorage.getItem("playerDept");
  if(n) nameInput.value = n;
  if(d) departmentSelect.value = d;
})();

/* ===== SUPABASE EDGE ===== */
const EDGE_FUNCTION_URL =
  "https://ahezssoczvpbkteffcgz.supabase.co/functions/v1/logQuest";

function sendViaEdgeFunction(payload){
  fetch(EDGE_FUNCTION_URL,{
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body:JSON.stringify(payload)
  }).catch(()=>{});
}

/* ===== DATA ===== */
const quizData=[
  {q:"He ___ happy today.",correct:"is"},
  {q:"They ___ my friends.",correct:"are"},
  {q:"She ___ absent.",correct:"is"},
  {q:"We ___ late.",correct:"are"},
  {q:"My parents ___ proud.",correct:"are"}
];

let current=0, gems=0, streak=0, bestStreak=0;
let questionLocked=false;
let startTime, timer;
let playerName="", playerDepartment="";

/* ===== START ===== */
startQuizBtn.onclick=()=>{
  playerName=nameInput.value.trim();
  playerDepartment=departmentSelect.value;
  if(!playerName||!playerDepartment) return alert("Enter name & department");

  localStorage.setItem("playerName",playerName);
  localStorage.setItem("playerDept",playerDepartment);

  nameForm.style.display="none";
  quizContent.style.display="block";
  quizHeaderBar.style.display="block";

  totalQ.innerText=quizData.length;
  startTime=Date.now();
  timer=setInterval(()=>timeValue.innerText=Math.floor((Date.now()-startTime)/1000),1000);

  loadQuestion();
};

function loadQuestion(){
  if(current>=quizData.length) return showScore();
  questionLocked=false;
  sentenceFlash.innerText=quizData[current].q;
  currentQ.innerText=current+1;
}

sniperIs.onclick=()=>answer("is");
sniperAre.onclick=()=>answer("are");

function answer(choice){
  if(questionLocked) return;
  questionLocked=true;

  const correct=quizData[current].correct;
  if(choice===correct){
    gems++; streak++;
    bestStreak=Math.max(bestStreak,streak);
    sentenceFlash.innerHTML=quizData[current].q.replace("___",`<b>${choice}</b>`);
    gemValue.innerText=gems;
    streakValue.innerText=streak;
    setTimeout(()=>{current++; loadQuestion();},700);
  }else{
    gems--; streak=0;
    gemValue.innerText=gems;
    streakValue.innerText=0;
    questionLocked=false;
  }
}

function showScore(){
  clearInterval(timer);
  quizHeaderBar.style.display="none";

  sendViaEdgeFunction({
    student_name:playerName,
    department:playerDepartment,
    score:gems,
    streak:bestStreak,
    quest_id:"IS-ARE-SNIPER"
  });

  sentenceFlash.innerText="ğŸ‰ Mission Complete!";
  scoreCard.innerHTML=`
    <p>ğŸ‘¤ ${playerName}</p>
    <p>ğŸ¢ ${playerDepartment}</p>
    <p>ğŸ’ Gems: ${gems}</p>
    <p>ğŸ”¥ Best Streak: ${bestStreak}</p>
  `;
  restartBtn.style.display="block";
}

restartBtn.onclick=()=>location.reload();
</script>
</body>
</html>
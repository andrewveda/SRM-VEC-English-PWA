<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>V for Vote of Thanks! Live long and prosper!üåå</title>

<link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;400;600;700&family=Orbitron:wght@700;900&family=DM+Sans:wght@400;600&display=swap" rel="stylesheet">

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.31/jspdf.plugin.autotable.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

<style>
:root {
  --bg-main: linear-gradient(135deg, #fdfbfb 0%, #ebedee 100%);
  --card-bg: #ffffff;
  --accent-main: #ff9800;
  --accent-soft: #ffcc80;
  --blue-main: #2979ff;
  --green-main: #00c853;
  --red-main: #e53935;
  --text-main: #1f2933;
  --text-muted: #6b7280;
}

* { box-sizing: border-box; }

body {
  margin: 0; padding: 0;
  font-family: 'DM Sans', 'Segoe UI', sans-serif;
  background: var(--bg-main);
  color: var(--text-main);
  text-align: center;
}

.container {
  position: relative;
  max-width: 900px;
  margin: 2rem auto;
  background: var(--card-bg);
  padding: 2rem;
  border-radius: 18px;
  box-shadow: 0 15px 35px rgba(0,0,0,0.12);
}

.quiz-header {
  position: absolute;
  top: 10px; left: 0; right: 0;
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 0 1rem;
  font-size: 1rem;
  font-weight: bold;
  color: var(--blue-main);
}

.question {
  font-size: 1.6rem; font-weight: 700;
  margin-bottom: 1.2rem;
}

.drag-options {
  display: flex; flex-wrap: wrap; gap: 0.8rem;
  margin-bottom: 2rem; justify-content: center;
}

.drag-item {
  padding: 0.7rem 1.2rem;
  background: #f1f5f9; border-radius: 14px;
  cursor: pointer; user-select: none; font-weight: 600;
  transition: transform 0.2s ease, box-shadow 0.2s ease;
}
.drag-item:hover { transform: translateY(-2px); box-shadow: 0 6px 15px rgba(0,0,0,0.15); }
.drag-item.selected { background: var(--accent-main); color: #fff; }

.drop-container { display: flex; flex-direction: column; gap: 1rem; align-items: center; }

.drop-zone {
  width: 100%; max-width: 520px; min-height: 44px;
  padding: 0.7rem 1rem; border-radius: 12px;
  border: 2px dashed var(--blue-main);
  cursor: pointer; font-weight: 600; background: #f8fafc;
}
.drop-zone.filled { border-style: solid; background: #e3f2fd; }

.correct {
  background-color: #e8f5e9 !important;
  border-color: var(--green-main) !important;
  color: var(--green-main);
  animation: correctPulse 0.6s ease;
}
@keyframes correctPulse { 0%,100%{transform:scale(1)} 50%{transform:scale(1.05)} }

.wrong {
  background-color: #ffebee !important;
  border-color: var(--red-main) !important;
  color: var(--red-main);
  animation: wrongShake 0.5s ease;
}
@keyframes wrongShake {
  0%,100%{transform:translateX(0)} 25%{transform:translateX(-10px)} 75%{transform:translateX(10px)}
}

@keyframes gemPop {
  0%{transform:scale(1)} 50%{transform:scale(1.3) rotate(10deg)} 100%{transform:scale(1) rotate(0deg)}
}
.gem-pop { animation: gemPop 0.5s ease; }

#motivationBox {
  margin-top: 2rem; min-height: 120px; padding: 1.5rem;
  font-size: 1.9rem; font-weight: 800; color: var(--accent-main);
  background: linear-gradient(135deg, #fff3e0, #ffe0b2);
  border-radius: 18px; box-shadow: 0 10px 25px rgba(255,152,0,0.35);
}

.hero-quote {
  max-width: 94%; margin: 0.6rem auto 1.2rem auto;
  padding: 1rem; background: linear-gradient(135deg, #000000, #1a1a1a);
  border-radius: 10px;
}
.hero-text { font-size: 1.2rem; font-weight: 700; color: #FFD700; line-height: 1.3; }
.hero-author { margin-top: 0.3rem; font-size: 0.95rem; font-weight: 600; color: #d4af37; }

#nameForm {
  display: flex; flex-direction: column; align-items: center; gap: 1rem;
  background: linear-gradient(135deg, #ffffff, #f1f5f9);
  padding: 2rem 1.5rem; border-radius: 20px;
  box-shadow: 0 12px 30px rgba(0,0,0,0.18);
  max-width: 420px; margin: 2rem auto;
}

#nameInput, #departmentSelect {
  width: 100%; padding: 0.9rem 1rem;
  background: #ffffff; border: 2px solid #cbd5e1;
  border-radius: 12px; font-size: 1rem; outline: none;
}
#nameInput:focus, #departmentSelect:focus {
  border-color: var(--blue-main);
  box-shadow: 0 0 0 3px rgba(41,121,255,0.25);
}

#nameForm button {
  width: 100%; padding: 1rem;
  background: linear-gradient(135deg, var(--accent-main), #ffb300);
  color: #000; font-size: 1.1rem; font-weight: bold;
  border: none; border-radius: 14px; cursor: pointer;
  transition: transform 0.2s ease, box-shadow 0.2s ease;
}
#nameForm button:hover {
  transform: translateY(-3px);
  box-shadow: 0 10px 25px rgba(255,152,0,0.45);
}

#restartBtn {
  margin-top: 1.5rem; padding: 0.8rem 2.2rem;
  background: linear-gradient(135deg, #2979ff, #00b0ff);
  color: #fff; border: none; border-radius: 14px;
  font-weight: bold; cursor: pointer;
}

@media (max-width: 600px) {
  .question { font-size: 1.3rem; }
  .hero-text { font-size: 1.4rem; }
}

/* ============================================
   ‚ú® SCORE PORTAL ‚Äî MOBILE-FIRST PWA DESIGN
   ============================================ */

/* Lock the quiz container padding on mobile */
@media (max-width: 600px) {
  .container {
    margin: 0;
    border-radius: 0;
    min-height: 100dvh;
    padding: 1rem 0.9rem;
    box-shadow: none;
  }
}

.score-portal {
  position: relative;
  overflow: hidden;
  margin-top: 0.5rem;
  padding: 1.1rem 1rem 1.2rem;
  border-radius: 20px;
  background: #060d1a;
  color: #e2e8f0;
  box-shadow:
    0 0 0 1px rgba(255,215,0,0.14),
    0 20px 50px rgba(0,0,0,0.6);
  animation: portalEntrance 0.6s cubic-bezier(0.16, 1, 0.3, 1);
  height: auto;
  max-height: none;
}

/* Deep-space noise texture overlay */
.score-portal::before {
  content: "";
  position: absolute; inset: 0; z-index: 0; border-radius: 20px;
  background-image:
    radial-gradient(1px 1px at 15% 25%, rgba(255,255,255,0.22) 0%, transparent 100%),
    radial-gradient(1px 1px at 50% 12%, rgba(255,255,255,0.18) 0%, transparent 100%),
    radial-gradient(1px 1px at 82% 60%, rgba(255,255,255,0.16) 0%, transparent 100%),
    radial-gradient(1px 1px at 8%  80%, rgba(255,255,255,0.20) 0%, transparent 100%),
    radial-gradient(1px 1px at 92% 35%, rgba(255,255,255,0.14) 0%, transparent 100%),
    radial-gradient(2px  2px at 38% 90%, rgba(255,215,0,0.28) 0%, transparent 100%),
    radial-gradient(2px  2px at 68% 8%,  rgba(255,215,0,0.22) 0%, transparent 100%);
  pointer-events: none;
}

/* Warm amber glow blob top-right */
.score-portal::after {
  content: "";
  position: absolute; top: -30px; right: -30px; z-index: 0;
  width: 140px; height: 140px; border-radius: 50%;
  background: radial-gradient(circle, rgba(255,140,0,0.2) 0%, transparent 70%);
  pointer-events: none;
}

.score-portal > * { position: relative; z-index: 1; }

@keyframes portalEntrance {
  from { opacity: 0; transform: translateY(22px) scale(0.95); }
  to   { opacity: 1; transform: translateY(0)    scale(1); }
}

/* ---- TOP STRIP: title + player pill ---- */
.portal-header {
  display: flex;
  flex-direction: column;    
  align-items: center;
  gap: 0.35rem;
  margin-bottom: 0.85rem;
}


.portal-title {
  font-family: 'Orbitron', monospace;
  font-size: 0.85rem;
  font-weight: 900;
  letter-spacing: 2.5px;
  text-transform: uppercase;
  color: #FFD700;
  text-shadow: 0 0 14px rgba(255,215,0,0.55);
  white-space: nowrap;
}

.portal-player {
  width: 100%;                 /* Full width */
  font-size: 0.95rem;          /* Bigger */
  font-weight: 700;
  color: #e2e8f0;

  background: rgba(255,255,255,0.06);
  border: 1px solid rgba(255,215,0,0.25);

  padding: 0.55rem 0.8rem;
  border-radius: 12px;

  text-align: center;

  word-break: break-word;
  line-height: 1.35;
}
.portal-player {
  box-shadow: 0 0 18px rgba(255,215,0,0.18);
}


/* ---- CORE ROW: ring LEFT, stats RIGHT ---- */
.portal-body {
  display: grid;
  grid-template-columns: 100px 1fr;
  gap: 0.9rem;
  align-items: center;
  margin-bottom: 0.8rem;
}

/* ---- ACCURACY RING ---- */
.accuracy-wrapper { display: flex; justify-content: center; }

.accuracy-ring {
  width: 100px; height: 100px;
  border-radius: 50%;
  position: relative;
  display: flex; align-items: center; justify-content: center;
  box-shadow: 0 0 0 1px rgba(255,255,255,0.05), 0 6px 18px rgba(0,0,0,0.5);
  animation: ringReveal 0.8s cubic-bezier(0.16, 1, 0.3, 1);
  flex-shrink: 0;
}
.accuracy-ring::before {
  content: "";
  position: absolute; inset: 0; border-radius: 50%;
  background: conic-gradient(
    var(--ring-color) calc(var(--progress) * 1%),
    rgba(255,255,255,0.05) 0
  );
}
@keyframes ringReveal {
  from { transform: scale(0.55) rotate(-30deg); opacity: 0; }
  to   { transform: scale(1)    rotate(0deg);   opacity: 1; }
}

.accuracy-inner {
  width: 74px; height: 74px;
  border-radius: 50%;
  background: #060d1a;
  display: flex; flex-direction: column;
  align-items: center; justify-content: center;
  box-shadow: inset 0 0 0 1px rgba(255,255,255,0.05);
  z-index: 1;
}

.accuracy-value {
  font-family: 'Orbitron', monospace;
  font-size: 1.3rem; font-weight: 900;
  color: var(--ring-color);
  line-height: 1;
  animation: accuracyPulse 2.2s ease-in-out infinite;
}
@keyframes accuracyPulse {
  0%,100% { transform: scale(1); }
  50%     { transform: scale(1.07); }
}

.accuracy-label {
  font-size: 0.5rem; letter-spacing: 1.5px;
  text-transform: uppercase; color: #475569;
  margin-top: 2px;
}

/* ---- 2√ó2 STAT GRID ---- */
.stats-grid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 0.5rem;
}

.stat-card {
  background: rgba(255,255,255,0.03);
  border: 1px solid rgba(255,255,255,0.07);
  border-radius: 12px;
  /* Generous tap target height */
  padding: 0.6rem 0.65rem 0.55rem;
  display: flex; flex-direction: column;
  align-items: flex-start;
  /* Staggered entrance */
  animation: statFloat 0.45s ease both;
}
.stat-card:nth-child(1) { animation-delay: 0.05s; }
.stat-card:nth-child(2) { animation-delay: 0.12s; }
.stat-card:nth-child(3) { animation-delay: 0.19s; }
.stat-card:nth-child(4) { animation-delay: 0.26s; }

@keyframes statFloat {
  from { transform: translateY(10px); opacity: 0; }
  to   { transform: translateY(0);    opacity: 1; }
}

/* Active state for touch ‚Äî replaces :hover */
.stat-card:active {
  background: rgba(255,255,255,0.07);
  border-color: rgba(255,255,255,0.18);
  transform: scale(0.97);
  transition: transform 0.1s ease;
}

.stat-emoji {
  font-size: 0.85rem; line-height: 1;
  margin-bottom: 0.15rem; opacity: 0.75;
}
.stat-value {
  font-family: 'Orbitron', monospace;
  font-size: 1.45rem; font-weight: 900;
  line-height: 1; margin-bottom: 0.12rem;
}
.stat-label {
  font-size: 0.58rem; letter-spacing: 1px;
  text-transform: uppercase; color: #475569;
}

.correct-card .stat-value { color: #00e676; text-shadow: 0 0 10px rgba(0,230,118,0.4); }
.wrong-card   .stat-value { color: #ff5252; text-shadow: 0 0 10px rgba(255,82,82,0.4); }
.gems-card    .stat-value { color: #FFD700; text-shadow: 0 0 12px rgba(255,215,0,0.5); }
.time-card    .stat-value { color: #38bdf8; text-shadow: 0 0 10px rgba(56,189,248,0.4);
                            font-size: 1.1rem; /* prevents overflow for long time strings */ }

/* ---- PERFORMANCE BADGE ---- */
.performance-message {
  font-size: 0.88rem; font-weight: 700;
  color: #fbbf24;
  background: rgba(251,191,36,0.07);
  border: 1px solid rgba(251,191,36,0.2);
  border-radius: 10px;
  padding: 0.5rem 0.75rem;
  margin-bottom: 0.8rem;
  text-align: left;
  line-height: 1.4;
}

 
.portal-actions {
  display: flex;
  flex-direction: column;  
  gap: 0.6rem;
}


.next-quest-btn {
  /* min 48px tap target */
  padding: 0.9rem 1rem;
  font-family: 'Orbitron', monospace;
  font-size: 0.78rem; font-weight: 700;
  letter-spacing: 1px; text-transform: uppercase;
  border-radius: 14px; border: none; cursor: pointer;
  background: linear-gradient(135deg, #ff9800, #ffb300);
  color: #000;
  box-shadow: 0 4px 18px rgba(255,152,0,0.4);
  /* GPU-accelerated tap feedback */
  -webkit-tap-highlight-color: transparent;
  transition: transform 0.15s ease, box-shadow 0.15s ease;
  touch-action: manipulation;
}
.next-quest-btn:active {
  transform: scale(0.96);
  box-shadow: 0 2px 10px rgba(255,152,0,0.3);
}

.report-btn {
  padding: 0.9rem 0.8rem;
  font-size: 1.2rem; /* emoji icon */
  border-radius: 14px;
  border: 1px solid rgba(255,255,255,0.1);
  background: rgba(255,255,255,0.04);
  color: #94a3b8; cursor: pointer;
  -webkit-tap-highlight-color: transparent;
  transition: background 0.15s ease;
  touch-action: manipulation;
  display: flex; align-items: center; justify-content: center;
  min-width: 52px; /* comfortable thumb target */
}
.report-btn:active {
  background: rgba(255,255,255,0.1);
  transform: scale(0.95);
}
  :root {
  --bg-main: linear-gradient(135deg, #fdfbfb 0%, #ebedee 100%);
  --card-bg: #ffffff;
  --accent-main: #ff9800;
  --accent-soft: #ffcc80;
  --blue-main: #2979ff;
  --green-main: #00c853;
  --red-main: #e53935;
  --text-main: #1f2933;
  --text-muted: #6b7280;
}

* { box-sizing: border-box; }

body {
  margin: 0; padding: 0;
  font-family: 'DM Sans', 'Segoe UI', sans-serif;
  background: var(--bg-main);
  color: var(--text-main);
  text-align: center;
}

.container {
  position: relative;
  max-width: 900px;
  margin: 2rem auto;
  background: var(--card-bg);
  padding: 2rem;
  border-radius: 18px;
  box-shadow: 0 15px 35px rgba(0,0,0,0.12);
}

.quiz-header {
  position: absolute;
  top: 10px; left: 0; right: 0;
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 0 1rem;
  font-size: 1rem;
  font-weight: bold;
  color: var(--blue-main);
}

.question {
  font-size: 1.6rem; font-weight: 700;
  margin-bottom: 1.2rem;
}

.drag-options {
  display: flex; flex-wrap: wrap; gap: 0.8rem;
  margin-bottom: 2rem; justify-content: center;
}

.drag-item {
  padding: 0.7rem 1.2rem;
  background: #f1f5f9; border-radius: 14px;
  cursor: pointer; user-select: none; font-weight: 600;
  transition: transform 0.2s ease, box-shadow 0.2s ease;
}
.drag-item:hover { transform: translateY(-2px); box-shadow: 0 6px 15px rgba(0,0,0,0.15); }
.drag-item.selected { background: var(--accent-main); color: #fff; }

.drop-container { display: flex; flex-direction: column; gap: 1rem; align-items: center; }

.drop-zone {
  width: 100%; max-width: 520px; min-height: 44px;
  padding: 0.7rem 1rem; border-radius: 12px;
  border: 2px dashed var(--blue-main);
  cursor: pointer; font-weight: 600; background: #f8fafc;
}
.drop-zone.filled { border-style: solid; background: #e3f2fd; }

.correct {
  background-color: #e8f5e9 !important;
  border-color: var(--green-main) !important;
  color: var(--green-main);
  animation: correctPulse 0.6s ease;
}
@keyframes correctPulse { 0%,100%{transform:scale(1)} 50%{transform:scale(1.05)} }

.wrong {
  background-color: #ffebee !important;
  border-color: var(--red-main) !important;
  color: var(--red-main);
  animation: wrongShake 0.5s ease;
}
@keyframes wrongShake {
  0%,100%{transform:translateX(0)} 25%{transform:translateX(-10px)} 75%{transform:translateX(10px)}
}

@keyframes gemPop {
  0%{transform:scale(1)} 50%{transform:scale(1.3) rotate(10deg)} 100%{transform:scale(1) rotate(0deg)}
}
.gem-pop { animation: gemPop 0.5s ease; }

#motivationBox {
  margin-top: 2rem; min-height: 120px; padding: 1.5rem;
  font-size: 1.9rem; font-weight: 800; color: var(--accent-main);
  background: linear-gradient(135deg, #fff3e0, #ffe0b2);
  border-radius: 18px; box-shadow: 0 10px 25px rgba(255,152,0,0.35);
}

.hero-quote {
  max-width: 94%; margin: 0.6rem auto 1.2rem auto;
  padding: 1rem; background: linear-gradient(135deg, #000000, #1a1a1a);
  border-radius: 10px;
}
.hero-text { font-size: 1.2rem; font-weight: 700; color: #FFD700; line-height: 1.3; }
.hero-author { margin-top: 0.3rem; font-size: 0.95rem; font-weight: 600; color: #d4af37; }

#nameForm {
  display: flex; flex-direction: column; align-items: center; gap: 1rem;
  background: linear-gradient(135deg, #ffffff, #f1f5f9);
  padding: 2rem 1.5rem; border-radius: 20px;
  box-shadow: 0 12px 30px rgba(0,0,0,0.18);
  max-width: 420px; margin: 2rem auto;
}

#nameInput, #departmentSelect {
  width: 100%; padding: 0.9rem 1rem;
  background: #ffffff; border: 2px solid #cbd5e1;
  border-radius: 12px; font-size: 1rem; outline: none;
}
#nameInput:focus, #departmentSelect:focus {
  border-color: var(--blue-main);
  box-shadow: 0 0 0 3px rgba(41,121,255,0.25);
}

#nameForm button {
  width: 100%; padding: 1rem;
  background: linear-gradient(135deg, var(--accent-main), #ffb300);
  color: #000; font-size: 1.1rem; font-weight: bold;
  border: none; border-radius: 14px; cursor: pointer;
  transition: transform 0.2s ease, box-shadow 0.2s ease;
}
#nameForm button:hover {
  transform: translateY(-3px);
  box-shadow: 0 10px 25px rgba(255,152,0,0.45);
}

#restartBtn {
  margin-top: 1.5rem; padding: 0.8rem 2.2rem;
  background: linear-gradient(135deg, #2979ff, #00b0ff);
  color: #fff; border: none; border-radius: 14px;
  font-weight: bold; cursor: pointer;
}

@media (max-width: 600px) {
  .container {
    margin: 0;
    border-radius: 0;
    min-height: 100dvh;
    padding: 1rem 0.9rem;
    box-shadow: none;
  }
}

/* ============================================
   ‚ú® SCORE PORTAL ‚Äî FIXED LAYOUT
   ============================================ */

.score-portal {
  position: relative;
  overflow: hidden;
  margin-top: 0.5rem;
  padding: 1.1rem 1rem 1.2rem;
  border-radius: 20px;
  background: #060d1a;
  color: #e2e8f0;
  box-shadow:
    0 0 0 1px rgba(255,215,0,0.14),
    0 20px 50px rgba(0,0,0,0.6);
}

/* STACKED LAYOUT */
.portal-body {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 1rem;
  margin-bottom: 0.9rem;
}

/* LARGER RING */
.accuracy-ring {
  width: 160px;
  height: 160px;
  border-radius: 50%;
  position: relative;
  display: flex; align-items: center; justify-content: center;
}

.accuracy-inner {
  width: 110px;
  height: 110px;
  border-radius: 50%;
  background: #060d1a;
  display: flex; flex-direction: column;
  align-items: center; justify-content: center;
}

.accuracy-value {
  font-family: 'Orbitron', monospace;
  font-size: 2.1rem;
  font-weight: 900;
}

/* FULL WIDTH STATS BELOW */
.stats-grid {
  width: 100%;
  max-width: 360px;
}

.stat-card {
  background: rgba(255,255,255,0.03);
  border: 1px solid rgba(255,255,255,0.07);
  border-radius: 12px;
  padding: 0.6rem 0.65rem 0.55rem;
}
.report-btn {
  width: 100%;                      /* Full width */
  padding: 0.9rem 1rem;

  font-family: 'Orbitron', monospace;
  font-size: 0.78rem;
  font-weight: 700;
  letter-spacing: 1px;
  text-transform: uppercase;

  border-radius: 14px;
  border: none;

  background: linear-gradient(135deg, #38bdf8, #0ea5e9);
  color: #021018;

  box-shadow: 0 4px 18px rgba(56,189,248,0.35);

  cursor: pointer;
  -webkit-tap-highlight-color: transparent;
  transition: transform 0.15s ease, box-shadow 0.15s ease;
}
.report-btn:active {
  transform: scale(0.96);
  box-shadow: 0 2px 10px rgba(56,189,248,0.25);
}

</style>
</head>

<body>
<div class="container" id="quizContainer">
  <div id="nameForm">
    <div class="hero-quote">
      <div class="hero-text">We love trying!</div>
      <div class="hero-author">ü§ó‚ô•Ô∏è‚ú®</div>
    </div>
    <input type="text" id="nameInput" placeholder="Enter your name"/>
    <select id="departmentSelect">
      <option value="">-- Select Department --</option>
      <option value="Cyber Security">Cyber Security</option>
      <option value="EIE">EIE</option>
      <option value="CSE-1">CSE-1</option>
      <option value="CSE-2">CSE-2</option>
      <option value="CSE-3">CSE-3</option>
      <option value="Mechanical Engineering">Mechanical Engineering</option>
      <option value="ECE-1">ECE-1</option>
      <option value="ECE-2">ECE-2</option>
      <option value="ECE-3">ECE-3</option>
      <option value="AI DS-1">AI DS-1</option>
      <option value="AI DS-2">AI DS-2</option>
      <option value="Agri and Civil">Agri and Civil</option>
      <option value="EEE">EEE</option>
      <option value="Medical Electronics">Medical Electronics</option>
      <option value="IT-1">IT-1</option>
      <option value="IT-2">IT-2</option>
    </select>
    <button onclick="beginQuiz()">Start Quiz</button>
  </div>

  <!-- QUIZ SCREEN -->
  <div id="quizContent" style="display:none;">
    <div class="quiz-header">
      <div id="timer">‚è≥ 0s</div>
      <div id="gemsCounter">üíé 0</div>
      <button id="muteBtn" title="Mute / Unmute"
        style="background:none;border:none;font-size:1.2rem;cursor:pointer;">üîä</button>
      <div id="progressTracker">üìç 1 of 1</div>
    </div>

    <div class="question" id="question"></div>
    <div class="drag-options" id="dragOptions"></div>
    <div class="drop-container" id="dropContainer"></div>

    <div id="scoreCard"></div>
    <button id="restartBtn" style="display:none;">Restart</button>
  </div>

  <!-- SCORE SCREEN ‚Äî shown only after quiz ends -->
  <div id="scoreScreen" style="display:none; padding-top: 2rem;"></div>

</div>

<div id="motivationBox"></div>

<script>
/* ========== CONFETTI ========== */
function triggerConfetti() {
  confetti({ particleCount: 100, spread: 70, origin: { y: 0.6 } });
}
function triggerConfettiSides() {
  const end = Date.now() + 1000;
  (function frame() {
    confetti({ particleCount: 2, angle: 60,  spread: 55, origin: { x: 0 }, colors: ['#ff9800','#2979ff','#00c853','#FFD700'] });
    confetti({ particleCount: 2, angle: 120, spread: 55, origin: { x: 1 }, colors: ['#ff9800','#2979ff','#00c853','#FFD700'] });
    if (Date.now() < end) requestAnimationFrame(frame);
  }());
}
function triggerMegaConfetti() {
  const duration = 3000, animationEnd = Date.now() + duration;
  const defaults = { startVelocity: 30, spread: 360, ticks: 60, zIndex: 0 };
  function randomInRange(min, max) { return Math.random() * (max - min) + min; }
  const interval = setInterval(function() {
    const timeLeft = animationEnd - Date.now();
    if (timeLeft <= 0) return clearInterval(interval);
    const particleCount = 50 * (timeLeft / duration);
    confetti(Object.assign({}, defaults, { particleCount, origin: { x: randomInRange(0.1, 0.3), y: Math.random() - 0.2 } }));
    confetti(Object.assign({}, defaults, { particleCount, origin: { x: randomInRange(0.7, 0.9), y: Math.random() - 0.2 } }));
  }, 250);
}

/* ========== AUDIO ========== */
let isMuted = localStorage.getItem("questMuted") === "true";
const applauseSound = new Audio('https://andrewveda.github.io/SRM-VEC-English-PWA/sounds/crowd.mp3');
const wrongSound    = new Audio('https://assets.mixkit.co/active_storage/sfx/2955/2955-preview.mp3');
applauseSound.volume = 0.4; wrongSound.volume = 0.3;
applauseSound.load(); wrongSound.load();
applauseSound.muted = isMuted; wrongSound.muted = isMuted;

const muteBtn = document.getElementById("muteBtn");
muteBtn.innerText = isMuted ? "üîá" : "üîä";
muteBtn.onclick = () => {
  isMuted = !isMuted;
  localStorage.setItem("questMuted", isMuted);
  applauseSound.muted = isMuted; wrongSound.muted = isMuted;
  muteBtn.innerText = isMuted ? "üîá" : "üîä";
};

function playApplauseSound() {
  if (isMuted) return;
  try { applauseSound.currentTime = 0; applauseSound.play().catch(() => {}); } catch(e) {}
}
function playWrongSound() {
  if (isMuted) return;
  try { wrongSound.currentTime = 0; wrongSound.play().catch(() => {}); } catch(e) {}
}

/* ========== AUTO-RESTORE ========== */
window.addEventListener("load", () => {
  const savedName = localStorage.getItem("questPlayerName");
  const savedDept = localStorage.getItem("questPlayerDept");
  if (savedName) document.getElementById("nameInput").value = savedName;
  if (savedDept) document.getElementById("departmentSelect").value = savedDept;
});

/* ========== MOTIVATION ========== */
const rightMessages = [
  "'name' is unstoppable!",
  "'name' is awesome because 'name' has grit!",
  "'name' has got the right answer because 'name' loves trying!",
  "Nothing can slow 'name' down today!",
  "'name' learns fast because 'name' never gives up!",
  "Who is awesome? 'name'!",
  "'name' proves that effort beats talent every time!",
  "Every correct answer takes 'name' one step closer to greatness!",
  "'name' shines brighter with every question!"
];
const wrongMessages = [
  "'name' loves failures because 'name', like Edison, knows failure is the stepping stone to success.",
  "'name''s favourite quote: 'Ever tried. Ever failed. No matter. Try again. Fail again. Fail better.'",
  "Every mistake makes 'name' stronger.",
  "Mistakes guide 'name' towards victory!",
  "Failure is feedback, and 'name' takes feedback like a champion.",
  "Every wrong attempt brings 'name' closer to the right one.",
  "'name' believes in trying again and again and again!"
];

function showMotivation(isCorrect) {
  const box = document.getElementById("motivationBox");
  const list = isCorrect ? rightMessages : wrongMessages;
  let msg = list[Math.floor(Math.random() * list.length)].replace(/'name'/g, playerName);
  box.innerHTML = msg;
  box.style.opacity = 1;
}

/* ========== QUIZ DATA ========== */
const quizData = [
  {
    questionItems: [
      { word: "The best way ___ a new language is to immerse yourself in the culture.", answer: "to learn" },
      { word: "It's essential ___ regularly for maintaining good health.", answer: "to exercise" },
      { word: "The teacher assigned the students the task of ___ a historical event.", answer: "researching" }
    ],
    answers: ["to learn", "to exercise", "researching"]
  }
];

let current = 0, wrongQuestions = [], correctCount = 0, totalWrongGuesses = 0;
let gemsCount = 0, startTime, timerInterval, playerName = "", playerDept = "", selectedOption = null;

const questionEl       = document.getElementById("question");
const dragOptionsEl    = document.getElementById("dragOptions");
const dropContainerEl  = document.getElementById("dropContainer");
const timerEl          = document.getElementById("timer");
const gemsCounterEl    = document.getElementById("gemsCounter");
const progressTracker  = document.getElementById("progressTracker");
const scoreCard        = document.getElementById("scoreCard");
const restartBtn       = document.getElementById("restartBtn");
const NEXT_QUEST_URL   = "https://andrewveda.github.io/SRM-VEC-English-PWA/semII/8";
function goToNextQuest() { window.location.href = NEXT_QUEST_URL; }

/* ========== QUIZ FLOW ========== */
function beginQuiz() {
  const nameField = document.getElementById("nameInput");
  const deptField = document.getElementById("departmentSelect");
  if (!nameField.value.trim()) { alert("Please enter your name!"); return; }
  if (!deptField.value) { alert("Please select your department!"); return; }
  playerName = nameField.value.trim(); playerDept = deptField.value;
  localStorage.setItem("questPlayerName", playerName);
  localStorage.setItem("questPlayerDept", playerDept);
  document.getElementById("nameForm").style.display = "none";
  document.getElementById("quizContent").style.display = "block";
  startQuiz();
}

function startQuiz() {
  current = 0; correctCount = 0; totalWrongGuesses = 0; gemsCount = 0;
  startTime = Date.now();
  gemsCounterEl.innerText = "üíé 0"; scoreCard.innerHTML = "";
  restartBtn.style.display = "none";
  loadQuestion(); startTimer();
}

function loadQuestion() {
  if (current >= quizData.length) return showScore();
  selectedOption = null;
  const data = quizData[current];
  progressTracker.innerText = `üìç ${current + 1} of ${quizData.length}`;
  dragOptionsEl.innerHTML = ""; dropContainerEl.innerHTML = "";
  const shuffled = [...data.answers].sort(() => Math.random() - 0.5);
  shuffled.forEach(ans => {
    const div = document.createElement("div");
    div.classList.add("drag-item"); div.innerText = ans;
    div.onclick = () => selectOption(div);
    dragOptionsEl.appendChild(div);
  });
  data.questionItems.forEach(item => {
    const drop = document.createElement("div");
    drop.classList.add("drop-zone"); drop.innerText = item.word;
    drop.dataset.answer = item.answer; drop.onclick = () => placeOption(drop);
    dropContainerEl.appendChild(drop);
  });
}

function selectOption(div) {
  if (selectedOption) selectedOption.classList.remove("selected");
  selectedOption = div; div.classList.add("selected");
}

function placeOption(dropZone) {
  if (!selectedOption) return;
  const answer = selectedOption.innerText;
  const correctAnswer = dropZone.dataset.answer;
  if (answer === correctAnswer) {
    triggerConfetti(); playApplauseSound();
    correctCount++; gemsCount++;
    gemsCounterEl.innerText = `üíé ${gemsCount}`;
    gemsCounterEl.classList.add('gem-pop');
    setTimeout(() => gemsCounterEl.classList.remove('gem-pop'), 500);
    showMotivation(true);
    dropZone.innerHTML = dropZone.innerText.replace("___", `<strong>${answer}</strong>`);
    dropZone.classList.add("correct", "filled");
    selectedOption.style.display = "none";
  } else {
    playWrongSound(); totalWrongGuesses--; gemsCount--;
    gemsCounterEl.innerText = `üíé ${gemsCount}`;
    showMotivation(false);
    dropZone.classList.add("wrong");
    setTimeout(() => dropZone.classList.remove("wrong"), 600);
    const currentQ = quizData[current];
    if (!wrongQuestions.includes(currentQ)) wrongQuestions.push(currentQ);
  }
  selectedOption.classList.remove("selected"); selectedOption = null;
  if (document.querySelectorAll(".drop-zone:not(.filled)").length === 0) {
    setTimeout(() => {
      current++;
      if (current >= quizData.length && wrongQuestions.length > 0) {
        quizData.push(...wrongQuestions); wrongQuestions = [];
      }
      loadQuestion();
    }, 800);
  }
}

function startTimer() {
  timerInterval = setInterval(() => {
    const elapsed = Math.floor((Date.now() - startTime) / 1000);
    timerEl.innerText = `‚è≥ ${elapsed}s`;
  }, 1000);
}

function calculateAccuracy() {
  const total = correctCount + Math.abs(totalWrongGuesses);
  return total === 0 ? 0 : Math.round((correctCount / total) * 100);
}

function getAccuracyColor(acc) {
  if (acc >= 85) return "#00e676";
  if (acc >= 60) return "#ffcc00";
  return "#ff5252";
}

function animateAccuracy(finalAccuracy) {
  const ring = document.querySelector(".accuracy-ring");
  const valueEl = document.getElementById("accuracyValue");
  if (!ring || !valueEl) return;
  ring.style.setProperty("--ring-color", getAccuracyColor(finalAccuracy));
  let cur = 0;
  const anim = setInterval(() => {
    if (cur >= finalAccuracy) { clearInterval(anim); return; }
    cur++;
    ring.style.setProperty("--progress", cur);
    valueEl.innerText = `${cur}%`;
  }, 14);
}

function generatePerformanceMessage() {
  const acc = calculateAccuracy();
  if (acc >= 90) return "üåü Outstanding performance!";
  if (acc >= 75) return "üî• Strong work! Keep pushing!";
  if (acc >= 50) return "üí™ Good progress ‚Äî mastery is close!";
  return "üöÄ Every expert was once a beginner. Keep going!";
}

const EDGE_FUNCTION_URL = "https://ahezssoczvpbkteffcgz.supabase.co/functions/v1/logQuest";

function showScore() {
  clearInterval(timerInterval);
  const totalTime = Math.floor((Date.now() - startTime) / 1000);
  triggerMegaConfetti();

  // Hide the entire quiz UI ‚Äî only the score portal shows
  document.getElementById("quizContent").style.display = "none";
  document.getElementById("motivationBox").style.display = "none";
  window.scrollTo({ top: 0, behavior: "smooth" });

  const accuracy = calculateAccuracy();
  const mins = Math.floor(totalTime / 60), secs = totalTime % 60;
  const timeStr = mins > 0 ? `${mins}m ${secs}s` : `${secs}s`;

  const scoreScreen = document.getElementById("scoreScreen");
  scoreScreen.style.display = "block";
  scoreScreen.innerHTML = `
<div class="score-portal">

  <!-- TOP STRIP -->
  <div class="portal-header">
    <div class="portal-title">MISSION COMPLETE</div>
    <div class="portal-player">üë§ ${playerName} ¬∑ ${playerDept}</div>
  </div>

  <!-- RING + STAT GRID -->
  <div class="portal-body">
    <div class="accuracy-wrapper">
      <div class="accuracy-ring" style="--progress:0; --ring-color:#00e676;">
        <div class="accuracy-inner">
          <div class="accuracy-value" id="accuracyValue">0%</div>
          <div class="accuracy-label">Accuracy</div>
        </div>
      </div>
    </div>

    <div class="stats-grid">
      <div class="stat-card correct-card">
        <div class="stat-emoji">‚úÖ</div>
        <div class="stat-value">${correctCount}</div>
        <div class="stat-label">Correct</div>
      </div>
      <div class="stat-card wrong-card">
        <div class="stat-emoji">‚ùå</div>
        <div class="stat-value">${Math.abs(totalWrongGuesses)}</div>
        <div class="stat-label">Wrong</div>
      </div>
      <div class="stat-card gems-card">
        <div class="stat-emoji">üíé</div>
        <div class="stat-value">${gemsCount}</div>
        <div class="stat-label">Gems</div>
      </div>
      <div class="stat-card time-card">
        <div class="stat-emoji">‚è±Ô∏è</div>
        <div class="stat-value">${timeStr}</div>
        <div class="stat-label">Time</div>
      </div>
    </div>
  </div>

  <!-- PERFORMANCE BADGE -->
  <div class="performance-message">${generatePerformanceMessage()}</div>

  <!-- TAP TARGETS -->
  <div class="portal-actions">
    <button class="next-quest-btn" onclick="goToNextQuest()">üöÄ NEXT QUEST</button>
    <button onclick="downloadPDFReport()" class="report-btn" title="Download PDF Report">üì•</button>
  </div>


</div>`;

  setTimeout(() => animateAccuracy(accuracy), 80);

  sendViaEdgeFunction({
    student_name: playerName, department: playerDept,
    correct: correctCount, wrong: Math.abs(totalWrongGuesses),
    time_spent: totalTime, quest_id: "Quest 177"
  });
}

async function sendViaEdgeFunction(payload) {
  try {
    const response = await fetch(EDGE_FUNCTION_URL, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(payload),
    });
    if (!response.ok) { console.error("‚ùå Edge Function Error:", await response.text()); return; }
    console.log("‚úÖ Saved to Supabase");
  } catch (err) { console.error("‚ö†Ô∏è Edge Function Error:", err); }
}

function downloadPDFReport() {
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF();
  const totalTime = Math.floor((Date.now() - startTime) / 1000);
  const reportDate = new Date().toLocaleString('en-IN', { timeZone: 'Asia/Kolkata' });

  doc.setFillColor(25, 25, 60); doc.rect(0, 0, 210, 45, 'F');
  doc.setTextColor(255, 255, 255); doc.setFont('times', 'bold'); doc.setFontSize(18);
  doc.text('SRM VALLIAMMAI ENGINEERING COLLEGE', 105, 16, { align: 'center' });
  doc.setFontSize(12); doc.setFont('times', 'italic'); doc.text('(Autonomous)', 105, 23, { align: 'center' });
  doc.setFontSize(15); doc.setFont('times', 'normal'); doc.text('Department of English', 105, 31, { align: 'center' });
  doc.setFontSize(14); doc.setFont('times', 'bold'); doc.setTextColor(212, 175, 55);
  doc.text('Quest Performance Report', 105, 39, { align: 'center' });

  doc.setTextColor(0,0,0); doc.setFontSize(11); doc.text('CANDIDATE INFORMATION', 20, 55);
  doc.autoTable({
    startY: 58,
    body: [['Student Name', playerName], ['Department', playerDept], ['Quest ID', 'Quest 177'], ['Completed On', reportDate]],
    theme: 'plain',
    styles: { fontSize: 10, font: 'times', cellPadding: 3 },
    columnStyles: { 0: { fontStyle: 'bold', cellWidth: 60, textColor: [70,70,70] }, 1: { cellWidth: 120 } },
    margin: { left: 20, right: 20 }
  });

  let y = doc.lastAutoTable.finalY + 10;
  doc.setFont('times', 'bold'); doc.text('PERFORMANCE SUMMARY', 20, y); y += 4;
  doc.autoTable({
    startY: y + 3,
    body: [
      ['Total Questions', quizData.length.toString()],
      ['Correct Answers', correctCount.toString()],
      ['Wrong Attempts', Math.abs(totalWrongGuesses).toString()],
      ['Final Gems Earned', gemsCount.toString()],
      ['Total Time', `${Math.floor(totalTime/60)}m ${totalTime%60}s`]
    ],
    theme: 'grid',
    styles: { fontSize: 10, font: 'times', cellPadding: 3 },
    margin: { left: 20, right: 20 }
  });

  y = doc.lastAutoTable.finalY + 12;
  if (y > 250) { doc.addPage(); y = 20; }
  doc.setFont('times', 'bold'); doc.text('QUESTION BANK WITH CORRECT ANSWERS', 20, y); y += 6;
  quizData.forEach((item, i) => {
    if (y > 260) { doc.addPage(); y = 20; }
    doc.setFontSize(11); doc.setFont('times', 'bold'); doc.setTextColor(25,25,60);
    doc.text(`Question ${i + 1}:`, 20, y); y += 6;
    doc.setTextColor(0,0,0); doc.setFont('times', 'normal');
    item.questionItems.forEach((qItem, j) => {
      const lines = doc.splitTextToSize(`${j+1}. ${qItem.word.replace('___','____')} `, 160);
      doc.text(lines, 25, y); y += lines.length * 5;
      doc.setTextColor(0,128,0); doc.text(`Answer: ${qItem.answer}`, 30, y);
      doc.setTextColor(0,0,0); y += 7;
    });
    y += 3;
    doc.setDrawColor(230,230,230); doc.setLineWidth(0.3); doc.line(20, y, 190, y); y += 5;
  });

  doc.setDrawColor(184,134,11); doc.setLineWidth(0.5); doc.line(20, 280, 190, 280);
  doc.setFontSize(8); doc.setTextColor(128,128,128); doc.setFont('times','italic');
  doc.text('This is a system-generated report', 105, 287, { align: 'center' });
  doc.save(`${playerName.replace(/[^a-zA-Z0-9]/g,'_')}_Quest177_Report.pdf`);
}

function playAgain() {
  document.getElementById("scoreScreen").style.display = "none";
  document.getElementById("scoreScreen").innerHTML = "";
  document.getElementById("quizContent").style.display = "none";
  document.getElementById("motivationBox").style.display = "";
  document.getElementById("nameForm").style.display = "block";
  document.getElementById("nameInput").value = "";
}

restartBtn.onclick = playAgain;
</script>
</body>
</html>

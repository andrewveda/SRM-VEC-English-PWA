<!doctype html>

<html lang="en">    
<head>    
<meta charset="utf-8" />    
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no" />    
<title>Wordle Embed</title>    
<style>    
:root{    
  --bg:#0b1220; --card:#0f1724; --text:#e6eef8;    
  --absent:#3a3a3c; --present:#b59f3b; --correct:#538d4e;    
  --key:#818384; --key-pressed:#565758;    
  font-family: Inter, system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial;    
}    
*{box-sizing:border-box;margin:0;padding:0}    
html,body{height:100%;background:var(--bg);color:var(--text);overflow:hidden}    
.wrap{display:flex;flex-direction:column;align-items:center;justify-content:center;height:100%;padding:10px;position:relative}    
.board{display:grid;grid-template-rows:repeat(6,64px);gap:6px;width:100%;max-width:400px}    
.row{display:grid;grid-template-columns:repeat(5,1fr);gap:6px}    
.tile{display:flex;align-items:center;justify-content:center;font-weight:700;font-size:24px;border-radius:6px;background:#121826;color:var(--text)}    
.tile.absent{background:var(--absent)}    
.tile.present{background:var(--present)}    
.tile.correct{background:var(--correct)}    
.keyboard{display:flex;flex-direction:column;gap:6px;margin-top:10px;width:100%;max-width:400px}    
.krow{display:flex;gap:4px;justify-content:center}    
.key{flex:1;padding:10px 0;border-radius:6px;text-align:center;user-select:none;background:var(--key);color:white;font-weight:700;cursor:pointer}    
.key.enter {    
  background: var(--correct); /* green */    
}  .key.back {  
background: #b91c1c; /* red */  
}  .key.wide{flex:1.5}
.hint{color:#9fb7db;margin-top:6px;font-size:14px;text-align:center}
.rules{font-family:'Cursive', sans-serif; text-align:center; margin-top:10px; color:#a0c4ff; font-size:14px;}
@media (min-width: 1024px) {
.container {width: 90vw; margin: 0 auto; height: auto;}
.keyboard {position: relative; max-height: 30vh; overflow-y: auto;}
.scorecard {position: fixed; top: 10px; right: 10px;}
}

/* ==== OVERLAY (Instructions Full Screen) ==== */
.overlay {
position: fixed;
top: 0; left: 0;
width: 100%; height: 100%;
background: linear-gradient(180deg, #0b1220 0%, #111a2d 100%);
display: flex;
justify-content: center;
align-items: center;
z-index: 30;
text-align: center;
padding: 30px;
}

.overlayContent {
background: var(--card);
padding: 60px 40px;
border-radius: 30px;
max-width: 800px;
width: 100%;
box-shadow: 0 0 40px rgba(0,0,0,0.6);
animation: fadeIn 0.6s ease-out;
}

.overlayContent h1 {
font-size: 3rem;
color: #fff;
margin-bottom: 20px;
text-shadow: 0 0 20px #1f6feb;
}

.overlayContent p {
font-size: 1.5rem;
line-height: 2rem;
margin: 10px 0;
color: #bcd3ef;
}

.overlayContent strong {
color: #ffd700;
}

#startBtn {
margin-top: 40px;
padding: 18px 36px;
font-size: 1.5rem;
font-weight: 700;
background: #1f6feb;
color: white;
border: none;
border-radius: 14px;
cursor: pointer;
transition: background 0.3s ease;
}

#startBtn:hover {
background: #2c8eff;
}

@keyframes fadeIn {
from {opacity: 0; transform: scale(0.8);}
to {opacity: 1; transform: scale(1);}
}

/* Scorecard popup */
.scorecard{position:absolute;top:50%;left:50%;transform:translate(-50%, -50%);background:var(--card);padding:40px 60px;border-radius:20px;box-shadow:0 10px 40px rgba(0,0,0,0.8);text-align:center;display:none;z-index:20;animation:pop 0.6s ease-out;}
.scorecard h1{font-size:48px;margin-bottom:20px;color:#fff;animation:scaleUp 1s ease-in-out;}
.scorecard p{font-size:24px;margin-bottom:20px;color:#bcd3ef;}
.scorecard input{padding:10px 12px;border-radius:8px;border:none;font-size:16px;margin-bottom:12px;width:80%;text-align:center;}
.scorecard button{padding:16px 24px;border:none;border-radius:12px;background:#1f6feb;color:white;font-weight:700;font-size:18px;cursor:pointer}
@keyframes pop{0%{transform:translate(-50%,-50%) scale(0.5);opacity:0;}50%{transform:translate(-50%,-50%) scale(1.1);opacity:1;}100%{transform:translate(-50%,-50%) scale(1);}}
@keyframes scaleUp{0%{transform:scale(0.3);opacity:0}50%{transform:scale(1.2);opacity:1}100%{transform:scale(1);opacity:1}}
.sparkle{position:absolute;width:10px;height:10px;background:radial-gradient(circle,#fff,#f0f0f0 70%);border-radius:50%;pointer-events:none;animation:fly 1.5s linear infinite;}
@keyframes fly{0%{transform:translate(0,0) scale(1);}50%{transform:translate(0,-200px) scale(0.5);}100%{transform:translate(200px,-400px) scale(0);opacity:0;}}
@media (max-width:520px){
.overlayContent {padding: 40px 20px;}
.overlayContent h1 {font-size: 2.2rem;}
.overlayContent p {font-size: 1.2rem;}
#startBtn {font-size: 1.2rem; padding: 14px 28px;}
}
</style>

</head>    
<body>    
  <div id="introOverlay" class="overlay">    
    <div class="overlayContent">    
      <h1>üéØ How to Play Wordle</h1>    
      <p>Guess the <strong>5-letter word</strong> in <strong>6 tries</strong>.</p>    
      <p>üü© <strong>Green</strong> = correct letter, correct place</p>    
      <p>üü® <strong>Yellow</strong> = letter is in the word, but wrong place</p>    
      <p>‚¨õ <strong>Gray</strong> = letter not in the word</p>    
      <p style="margin-top:20px; color:#9fb7db; font-size:1.3rem;">    
        Type letters on your keyboard or tap the on-screen keys.      
        Press <strong>Enter</strong> to submit your guess.    
      </p>    
      <button id="startBtn">üöÄ Start Game</button>    
    </div>    
  </div>    <div class="wrap">    
    <div id="board" class="board" aria-live="polite"></div>    
    <div class="keyboard" id="keyboard"></div>    
    <div class="hint" id="hint"></div>    
    <div class="rules">    
      Green = correct, Yellow = present, Gray = absent. <br>Good luck!    
    </div>    
    <div id="scorecard" class="scorecard">    
      <h1 id="scoreTitle"></h1>    
      <p id="scoreMsg"></p>    
      <input id="playerName" type="text" placeholder="Enter your name" />    
      <p id="leaderboardText" style="margin-bottom:12px; color:#bcd3ef; font-size:18px;"></p>    
      <button id="leaderboardBtn" style="display:none;">Check Leaderboard</button>    
      <button id="shareBtn">Share on WhatsApp</button>    
    </div>    
  </div>    <!-- Keep your full JS code here (unchanged) -->    <!-- Paste your original <script> content below this line -->  <script>    
const EDGE_FUNCTION_URL =    
  "https://ahezssoczvpbkteffcgz.supabase.co/functions/v1/logQuest";    async function sendViaEdgeFunction(payload) {
try {
const response = await fetch(EDGE_FUNCTION_URL, {
method: "POST",
headers: { "Content-Type": "application/json" },
body: JSON.stringify(payload),
});

if (!response.ok) {    
  console.error("‚ùå Edge function error:", await response.text());    
  return false;    
}    

await response.json().catch(() => ({}));    
return true;

} catch (err) {
console.error("‚ö†Ô∏è Error calling edge function:", err);
return false;
}
}
const CSV_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vQ5Z6lmXH4jxHYMKUcimj_M-IV1pwtBUF72YKJIi_BO-KD_NYwWBJBQqni7m4NmQyU9NMdve4vGZ7rh/pub?gid=0&single=true&output=csv';
let WORDS=[],ANSWER='',guesses=[],current='',MAX_GUESSES=6;
let startTime = Date.now(); // start timer
const boardEl=document.getElementById('board');
const keyboardEl=document.getElementById('keyboard');
const hintEl=document.getElementById('hint');
const scorecard=document.getElementById('scorecard');
const scoreTitle=document.getElementById('scoreTitle');
const scoreMsg=document.getElementById('scoreMsg');
const shareBtn = document.getElementById('shareBtn');
const introOverlay = document.getElementById('introOverlay');
const startBtn = document.getElementById('startBtn');
const NAME_KEY = 'wordle-player-name';
startBtn.addEventListener('click', () => {
introOverlay.style.display = 'none';
document.addEventListener('keydown', keydownHandler); // enable keyboard after overlay
});

// --- Save/Load progress ---
const STORAGE_KEY = 'wordle-progress';
function saveProgress() {
const data = { date: new Date().toDateString(), guesses, answer: ANSWER };
localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
}
function loadProgress() {
const data = JSON.parse(localStorage.getItem(STORAGE_KEY) || '{}');
return data;
}

// --- CSV parsing ---
function parseCSV(text){
const lines=text.split(/\r?\n/).map(l=>l.trim()).filter(Boolean);
return Array.from(new Set(lines.map(l=>l.split(/,|\t/)[0].trim().toLowerCase()))).filter(w=>/^[a-z]{5}$/.test(w));
}

// --- Board & Keyboard ---
function createBoard(){boardEl.innerHTML='';for(let r=0;r<MAX_GUESSES;r++){const row=document.createElement('div');row.className='row';for(let c=0;c<5;c++){const tile=document.createElement('div');tile.className='tile';row.appendChild(tile);}boardEl.appendChild(row);}}
function renderKeyboard(){keyboardEl.innerHTML='';const KEYS=['qwertyuiop','asdfghjkl','zxcvbnm'];KEYS.forEach(rowStr=>{const r=document.createElement('div');r.className='krow';for(const ch of rowStr){const k=document.createElement('div');k.className='key';k.textContent=ch;k.dataset.key=ch;k.addEventListener('click',()=>onKey(ch));r.appendChild(k);}if(rowStr==='asdfghjkl'){const enter=document.createElement('div');enter.className = 'key wide back';
;enter.textContent='‚å´';enter.addEventListener('click',()=>onKey('Backspace'));r.appendChild(enter);}if(rowStr==='zxcvbnm'){const back=document.createElement('div');back.className = 'key wide enter';back.textContent='Enter';back.addEventListener('click',()=>onKey('Enter'));r.appendChild(back);}keyboardEl.appendChild(r);});}

// --- Key handling ---
function onKey(k){if(k==='Enter')return submitGuess();if(k==='Backspace')return deleteLetter();if(current.length<5 && /^[a-zA-Z]$/.test(k)){current+=k.toLowerCase();updateBoard();}}
function deleteLetter(){if(current.length>0){current=current.slice(0,-1);updateBoard();}}
function updateBoard(){const row=boardEl.children[guesses.length];for(let c=0;c<5;c++){const tile=row.children[c];tile.textContent=current[c]||'';tile.className='tile';}}
function submitGuess() {
if (current.length !== 5) { hintEl.textContent = 'Guess must be 5 letters.'; return; }
if (!WORDS.includes(current.toLowerCase())) { hintEl.textContent = 'Not a valid English word.'; return; }
evaluateGuess(current);
current = '';
}
function evaluateGuess(guess){
const row=boardEl.children[guesses.length];
const answerArr=ANSWER.split('');
const guessArr=guess.split('');
const result=Array(5).fill('absent');
const answerFreq={};
for(let i=0;i<5;i++){answerFreq[answerArr[i]]=(answerFreq[answerArr[i]]||0)+1;}
for(let i=0;i<5;i++){if(guessArr[i]===answerArr[i]){result[i]='correct';answerFreq[guessArr[i]]--;}}
for(let i=0;i<5;i++){if(result[i]!=='correct' && answerFreq[guessArr[i]]>0){result[i]='present';answerFreq[guessArr[i]]--;}}
for(let i=0;i<5;i++){const tile=row.children[i];tile.textContent=guessArr[i];tile.classList.add(result[i]);}
updateKeys(guessArr,result);
guesses.push(guess);
saveProgress();
if(guess===ANSWER){showScore(true);document.removeEventListener('keydown',keydownHandler);return;}
if(guesses.length>=MAX_GUESSES){showScore(false);document.removeEventListener('keydown',keydownHandler);return;}
hintEl.textContent='';
}
function updateKeys(letters,results){letters.forEach((ch,i)=>{

const keyEls = keyboardEl.querySelectorAll('[data-key]');
keyEls.forEach(k=>{if(k.dataset.key===ch){if(results[i]==='correct'){k.style.backgroundColor='var(--correct)';}else if(results[i]==='present'){if(k.style.backgroundColor!=='var(--correct)')k.style.backgroundColor='var(--present)';}else{if(!k.style.backgroundColor)k.style.backgroundColor='var(--absent)';}}});});}
function keydownHandler(e){const k=e.key;if(k==='Enter')onKey('Enter');else if(k==='Backspace')onKey('Backspace');else if(/^[a-zA-Z]$/.test(k))onKey(k);}
function createSparkles(){for(let i=0;i<30;i++){const s=document.createElement('div');s.className='sparkle';s.style.left=Math.random()*window.innerWidth+'px';s.style.top=Math.random()*window.innerHeight+'px';s.style.animationDelay=Math.random()+'s';s.style.width=s.style.height=(5+Math.random()*10)+'px';document.body.appendChild(s);}}

function fetchToSheet(playerName){

const totalTime = Math.floor((Date.now() - startTime) / 1000);

sendViaEdgeFunction({
student_name: playerName,
tries: guesses.length,
time_spent: totalTime,
department: "Wordle",
answer: ANSWER
});
}
function showScore(win) {
  scorecard.style.display = 'block';
  createSparkles();

  // Clear daily progress
  localStorage.removeItem(STORAGE_KEY);

  const nameInput = document.getElementById('playerName');
  const leaderboardText = document.getElementById('leaderboardText');
  const leaderboardBtn = document.getElementById('leaderboardBtn');

  const savedName = localStorage.getItem(NAME_KEY);

  if (savedName) {
    nameInput.value = savedName;
    leaderboardText.textContent = `Welcome back, ${savedName}! üéâ`;
    fetchToSheet(savedName);
  } else {
    leaderboardText.textContent = "Join the leaderboard!";
  }

  // 3Ô∏è‚É£ Leaderboard button
  leaderboardBtn.style.display = "inline-block";
  leaderboardBtn.onclick = () => {
    window.open(
      "https://andrewveda.github.io/SRM-VEC-English-PWA/buttons/leaderboard_live",
      "_blank"
    );
  };

  // 4Ô∏è‚É£ When user enters/changes name
  nameInput.addEventListener('change', () => {
    const name = nameInput.value.trim() || 'Guest';
    localStorage.setItem(NAME_KEY, name);
    fetchToSheet(name);
    leaderboardText.textContent = `Thanks ${name}, your score is recorded!`;
  });

  // 5Ô∏è‚É£ Result message
  if (win) {
    const tries = guesses.length;
    if (tries === 1) {
      scoreTitle.textContent = 'üéâ Genius!';
      scoreMsg.textContent = `You got it in one try! The word was ${ANSWER.toUpperCase()}!`;
    } else if (tries === 2) {
      scoreTitle.textContent = '‚ú® Excellent!';
      scoreMsg.textContent = `Got it in 2 tries! The word was ${ANSWER.toUpperCase()}!`;
    } else if (tries <= 4) {
      scoreTitle.textContent = 'üåü Great!';
      scoreMsg.textContent = `Solved in ${tries} tries! The word was ${ANSWER.toUpperCase()}!`;
    } else {
      scoreTitle.textContent = 'üëç Good!';
      scoreMsg.textContent = `You solved it in ${tries} tries! The word was ${ANSWER.toUpperCase()}!`;
    }
  } else {
    scoreTitle.textContent = 'üíî Hard Luck';
    scoreMsg.textContent =
      `Hard luck. I could not crack today's Wordle. ` +
      `The word was ${ANSWER.toUpperCase()}! üòé ` +
      `Check it out: https://andrewveda.github.io/SRM-VEC-English-PWA/buttons/wordle`;
  }

  // 6Ô∏è‚É£ WhatsApp share
  shareBtn.onclick = () => {
    let grid = guesses.map((guess) => {
      const answerArr = ANSWER.split('');
      const guessArr = guess.split('');
      const result = Array(5).fill('‚¨ú');
      const answerFreq = {};

      answerArr.forEach(ch => answerFreq[ch] = (answerFreq[ch] || 0) + 1);

      for (let i = 0; i < 5; i++) {
        if (guessArr[i] === answerArr[i]) {
          result[i] = 'üü©';
          answerFreq[guessArr[i]]--;
        }
      }

      for (let i = 0; i < 5; i++) {
        if (result[i] === '‚¨ú' && answerFreq[guessArr[i]] > 0) {
          result[i] = 'üü®';
          answerFreq[guessArr[i]]--;
        }
      }

      return result.join('');
    }).join('\n');

    const msg = win
      ? `I solved today's Wordle in ${guesses.length} tries! üéâ\n${grid}\nüòé Check it out: https://andrewveda.github.io/SRM-VEC-English-PWA/buttons/wordle`
      : `Hard luck. I could not crack today's Wordle. üò¢\n${grid}\nLet us see if you can get it! üòé Check it out: https://andrewveda.github.io/SRM-VEC-English-PWA/buttons/wordle`;

    window.open(`https://wa.me/?text=${encodeURIComponent(msg)}`, '_blank');
  };
}
function chooseDailyWord() {
const today = new Date();
const start = new Date(today.getFullYear(), 0, 1);
const diff = today - start;
const dayOfYear = Math.floor(diff / (1000 * 60 * 60 * 24));
const index = dayOfYear % WORDS.length;
ANSWER = WORDS[index];
}

async function init() {
try {
const r = await fetch(CSV_URL);
const txt = await r.text();
WORDS = parseCSV(txt);
if (!WORDS.length) {
hintEl.textContent = 'No valid 5-letter words found.';
return;
}

chooseDailyWord();    
createBoard();    
renderKeyboard();    

// üî• Always start fresh    
guesses = [];    
current = "";    
localStorage.removeItem(STORAGE_KEY);    


} catch (e) {
hintEl.textContent = 'Failed to load word list.';
console.error(e);
}
}
init();

</script>  </body>

</html>

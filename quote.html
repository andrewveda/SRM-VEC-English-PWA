<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SRM VEC English â€” Quest & Video Calendar</title>
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#7A0019">

<style>
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; padding: 20px; }

.loading-screen {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  display: none;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  z-index: 9999;
  color: white;
}

.loading-screen.show {
  display: flex;
}

.loading-screen h1 {
  font-size: 1.5rem;
  margin-bottom: 20px;
  text-align: center;
  padding: 0 20px;
}

.spinner {
  width: 50px;
  height: 50px;
  border: 4px solid rgba(255,255,255,0.3);
  border-top-color: white;
  border-radius: 50%;
  animation: spin 1s linear infinite;
}

@keyframes spin {
  to { transform: rotate(360deg); }
}

.credits {
  position: absolute;
  bottom: 30px;
  font-size: 0.9rem;
  opacity: 0.9;
  text-align: center;
  padding: 0 20px;
}

.name-input-container {
  background: white;
  border-radius: 20px;
  padding: 40px 30px;
  max-width: 500px;
margin: 50px auto; 
  box-shadow: 0 20px 60px rgba(0,0,0,0.3);
  text-align: center;
  display: none;
}

.name-input-container.show {
  display: block;
}

.name-input-container h1 {
  color: #7A0019;
  font-size: 1.5rem;
  margin-bottom: 10px;
}

.name-input-container h2 {
  color: #333;
  font-size: 1.1rem;
  margin-bottom: 30px;
}

.name-input-container input {
  width: 100%;
  padding: 15px;
  font-size: 1rem;
  border: 2px solid #ddd;
  border-radius: 10px;
  margin-bottom: 15px;
  transition: border 0.3s;
}

.name-input-container input:focus {
  outline: none;
  border-color: #7A0019;
}

.name-input-container button, .name-input-container a button {
  width: 100%;
  padding: 15px;
  font-size: 1rem;
  border: none;
  border-radius: 10px;
  cursor: pointer;
  margin-bottom: 10px;
  transition: transform 0.2s, box-shadow 0.2s;
  font-weight: 600;
}

.name-input-container a {
  text-decoration: none;
  display: block;
}

.name-input-container button:hover {
  transform: translateY(-2px);
  box-shadow: 0 5px 15px rgba(0,0,0,0.2);
}

.btn-primary {
  background: #7A0019;
  color: white;
}

.btn-vocab {
  background: #4CAF50;
  color: white;
}

.btn-mystic {
  background: #FF5722;
  color: white;
}

.btn-wordle {
  background: #FFC0CB;
  color: black;
}

.btn-leaderboard {
  background: #A020F0;
  color: white;
}

.btn-elll {
  background: #000000;
  color: white;
}

.leaderboard-icon {
  position: fixed;
  bottom: 112px;
  left: 0;
  width: 100vw;
  height: 56px;
  background: white;
  border-radius: 0;         
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 1.2rem;
  cursor: pointer;
  box-shadow: 0 -4px 15px rgba(0,0,0,0.25);
  z-index: 1000;
  transition: transform 0.3s;
}

  .leaderboard-icon:hover {
  transform: scale(1.1);
}
.elll-icon {
  position: fixed;
  bottom: 56px;
  left: 0;
  width: 100vw;
  height: 56px;
  background: white;
  border-radius: 0;         
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 1.2rem;
  cursor: pointer;
  box-shadow: 0 -4px 15px rgba(0,0,0,0.25);
  z-index: 1000;
  transition: transform 0.3s;
}

.elll-icon:hover {
  transform: scale(1.1);
}

.profile-icon {
  position: fixed;
  bottom: 0;
  left: 0;
  width: 100vw;
  height: 56px;
  background: white;
  border-radius: 0;         
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 1.2rem;
  cursor: pointer;
  box-shadow: 0 -4px 15px rgba(0,0,0,0.25);
  z-index: 1000;
  transition: transform 0.3s;
}

  
.profile-icon.show {
  display: flex;
}

.profile-icon:hover {
  transform: scale(1.1);
}

.profile-drawer {
  position: fixed;
  top: 0;
  right: -350px;
  width: 350px;
  height: 100%;
  background: white;
  box-shadow: -5px 0 25px rgba(0,0,0,0.3);
  z-index: 999;
  transition: right 0.3s ease;
  overflow-y: auto;
  padding: 80px 20px 20px;
}

.profile-drawer.open {
  right: 0;
}

.profile-drawer h3 {
  color: #7A0019;
  margin-bottom: 20px;
  font-size: 1.3rem;
}

.drawer-item {
  padding: 15px;
  margin-bottom: 10px;
  background: #f5f5f5;
  border-radius: 10px;
  cursor: pointer;
  transition: background 0.3s;
}

.drawer-item:hover {
  background: #e0e0e0;
}

.drawer-item a {
  text-decoration: none;
  color: #333;
  display: flex;
  align-items: center;
  gap: 10px;
  font-weight: 500;
}

.close-drawer {
  position: absolute;
  top: 20px;
  right: 20px;
  font-size: 2rem;
  cursor: pointer;
  color: #666;
}

.overlay {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0,0,0,0.5);
  z-index: 998;
  display: none;
}

.overlay.active {
  display: block;
}

.calendar-container {
  background: white;
  border-radius: 20px;
  padding: 20px;
  max-width: 800px;
  margin: 0 auto;
  box-shadow: 0 20px 60px rgba(0,0,0,0.3);
  display: none;
  max-height: calc(100vh - 40px);
  overflow: hidden;
  flex-direction: column;
}

.calendar-container.show {
  display: flex;
}

.user-info {
  text-align: center;
  margin-bottom: 15px;
  flex-shrink: 0;
}

.user-info h2 {
  color: #7A0019;
  font-size: 1.5rem;
  margin-bottom: 15px;
}

.stats {
  display: flex;
  justify-content: center;
  gap: 20px;
  flex-wrap: wrap;
  margin-bottom: 20px;
}

.stat-box {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: white;
  padding: 15px 25px;
  border-radius: 10px;
  font-weight: 600;
}

.type-buttons {
  display: flex;
  justify-content: center;
  gap: 8px;
  margin-bottom: 12px;
  flex-wrap: wrap;
  flex-shrink: 0;
}

.type-button {
  padding: 10px 20px;
  border: none;
  border-radius: 10px;
  cursor: pointer;
  font-weight: 600;
  transition: all 0.3s;
  color: white;
  font-size: 0.9rem;
}

.type-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 5px 15px rgba(0,0,0,0.3);
}

.type-button.active {
  transform: translateY(-5px) scale(1.05); /* Lifts higher AND makes it bigger */
  box-shadow: 0 12px 25px rgba(0,0,0,0.4),  /* A darker, heavier shadow for depth */
          0 0 25px 5px currentColor;    /* A much wider and brighter glow */
  z-index: 2; /* Ensures it's visually on top of the other buttons */
}
.calendar {
  display: flex;
  flex-direction: column;
  flex: 1;
  min-height: 0;
  overflow: hidden;
}

.calendar-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 12px;
  flex-shrink: 0;
}

.calendar-header button {
  background: #7A0019;
  color: white;
  border: none;
  padding: 8px 16px;
  border-radius: 8px;
  cursor: pointer;
  font-size: 1rem;
}

.calendar-header div {
  font-size: 1.1rem;
  font-weight: 600;
  color: #333;
}

.days-of-week {
  display: grid;
  grid-template-columns: repeat(7, 1fr);
  gap: 4px;
  margin-bottom: 6px;
  font-weight: 600;
  text-align: center;
  color: #666;
  font-size: 0.85rem;
  flex-shrink: 0;
}

.dates {
  display: grid;
  grid-template-columns: repeat(7, 1fr);
  gap: 4px;
  flex: 1;
  align-content: start;
  overflow: hidden;
}

.dates div {
  aspect-ratio: 1;
  display: flex;
  align-items: center;
  justify-content: center;
  border-radius: 8px;
  cursor: pointer;
  font-weight: 500;
  transition: all 0.3s;
  font-size: 0.9rem;
}

.dates div:hover:not(.disabled) {
  transform: scale(1.05);
}

.dates .done {
  background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
  color: white;
}

.dates .missed {
  background: #ffebee;
  color: #c62828;
}

.dates .disabled {
  background: #f5f5f5;
  color: #ccc;
  cursor: default;
}

.offline-banner {
  background: #ff9800;
  color: white;
  padding: 12px;
  text-align: center;
  border-radius: 10px;
  margin-bottom: 12px;
  font-weight: 600;
  display: none;
  flex-shrink: 0;
  font-size: 0.9rem;
}

.offline-banner.show {
  display: block;
}

.logout-btn {
  width: 100%;
  padding: 15px;
  background: #c62828;
  color: white;
  border: none;
  border-radius: 10px;
  cursor: pointer;
  font-weight: 600;
  margin-top: 20px;
}

.custom-modal-overlay {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0, 0, 0, 0.6);
  display: none;
  align-items: center;
  justify-content: center;
  z-index: 10000;
  opacity: 0;
  transition: opacity 0.2s ease-in-out;
}
.custom-modal-overlay.show {
  display: flex;
  opacity: 1;
}
.custom-modal {
  background: white;
  padding: 30px;
  border-radius: 16px;
  box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
  width: 90%;
  max-width: 400px;
  text-align: center;
  transform: scale(0.9);
  transition: transform 0.2s ease-in-out;
}
.custom-modal-overlay.show .custom-modal {
  transform: scale(1);
}
.custom-modal p {
  font-size: 1.1rem;
  color: #333;
  margin-bottom: 25px;
  line-height: 1.5;
}
.modal-buttons {
  display: flex;
  gap: 15px;
  justify-content: center;
}
.modal-btn {
  border: none;
  border-radius: 10px;
  padding: 12px 20px;
  font-size: 1rem;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.2s;
  flex: 1;
}
.modal-btn-confirm {
  background: #c62828;
  color: white;
}
.modal-btn-confirm:hover {
  background: #a02020;
  transform: translateY(-2px);
}
.modal-btn-cancel {
  background: #e0e0e0;
  color: #333;
}
.modal-btn-cancel:hover {
  background: #c7c7c7;
  transform: translateY(-2px);
}

@media (max-width: 768px) {
  body {
    padding: 10px;
  }
 
  .calendar-container {
    padding: 12px;
    border-radius: 15px;
    max-height: calc(100vh - 20px);
  }
 
  .user-info h2 {
    font-size: 1.1rem;
    margin-bottom: 10px;
  }
 
  .type-button {
    padding: 8px 14px;
    font-size: 0.8rem;
  }
 
  .calendar-header button {
    padding: 6px 12px;
    font-size: 0.9rem;
  }
 
  .calendar-header div {
    font-size: 0.95rem;
  }
 
  .calendar-header {
    margin-bottom: 10px;
  }
 
  .days-of-week {
    font-size: 0.7rem;
    gap: 3px;
    margin-bottom: 4px;
  }
 
  .dates {
    gap: 3px;
  }
 
  .dates div {
    font-size: 0.75rem;
  }
 
  .offline-banner {
    padding: 10px;
    font-size: 0.85rem;
    margin-bottom: 10px;
  }
 
  .profile-drawer {
    width: 100%;
    right: -100%;
  }
}
.quotes-carousel {
  margin-top: 10px;
  text-align: center;
  color: #7A0019; 
  font-style: italic;
  font-size: 0.95rem;
  opacity: 0.9;
  transition: opacity 5s ease;
  min-height: 24px;
}
.level-dashboard {
  background: rgba(255, 255, 255, 0.2);
  backdrop-filter: blur(10px);
  border-radius: 20px;
  padding: 20px;
  color: white;
  text-align: center;
  box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
  margin: 0 auto 20px auto;
  max-width: 800px;
  animation: fadeIn 1s ease-out;
}

.level-dashboard h2 {
  font-size: 1.2rem;
  font-weight: 700;
  margin-bottom: 8px;
  letter-spacing: 1px;
  color: #ffe082;
  text-shadow: 0 0 10px rgba(255, 255, 255, 0.6);
}

.xp-bar {
  background: rgba(255, 255, 255, 0.3);
  border-radius: 10px;
  height: 12px;
  width: 100%;
  margin: 6px 0;
  overflow: hidden;
}

.xp-fill {
  height: 100%;
  background: linear-gradient(90deg, #ffcc33, #ff9100);
  border-radius: 10px;
  transition: width 1s ease-in-out;
}

.xp-text {
  font-size: 0.8rem;
  color: #eee;
  margin-bottom: 15px;
}

.power-bar-deck {
  display: flex;
  flex-wrap: wrap;
  justify-content: space-around;
  gap: 6px;
}

.power-item {
  display: flex;
  align-items: center;
  flex-direction: column;
  width: 60px;
  font-size: 0.8rem;
  color: #fff;
}

.power-bar {
  width: 100%;
  height: 6px;
  background: rgba(255, 255, 255, 0.25);
  border-radius: 5px;
  margin: 3px 0;
  overflow: hidden;
}

.power-bar .fill {
  height: 100%;
  border-radius: 5px;
  transition: width 1s ease;
}

.power-item:nth-child(1) .fill { background: linear-gradient(90deg, gold, orange); }
.power-item:nth-child(2) .fill { background: linear-gradient(90deg, #2196F3, #21CBF3); }
.power-item:nth-child(3) .fill { background: linear-gradient(90deg, #4CAF50, #8BC34A); }
.power-item:nth-child(4) .fill { background: linear-gradient(90deg, #FF5722, #FFC107); }
/* .power-item:nth-child(5) .fill { background: linear-gradient(90deg, #9C27B0, #E040FB); } */

.power-value {
  margin-top: 2px;
  font-weight: bold;
  font-size: 0.8rem;
  text-shadow: 0 0 5px rgba(0,0,0,0.3);
}

@keyframes fadeIn {
  from { opacity: 0; transform: translateY(-10px); }
  to { opacity: 1; transform: translateY(0); }
}

/* Desktop/laptop fix: allow full calendar to expand vertically */
@media (min-width: 1025px) {
  /* let the calendar container expand instead of clipping */
  .calendar-container {
    max-height: none;    /* remove the viewport-limited height */
    overflow: visible;    /* show the whole calendar */
  }

  /* allow date cells to have a fixed height (not forced square) */
  .dates div {
    aspect-ratio: auto;  /* stop forcing 1:1 squares on desktop */
    height: 78px;        /* comfortable row height for desktop */
    display: flex;
    align-items: center;
    justify-content: center;
  }

  /* make sure calendar column track stays readable when wide */
  .dates {
    align-content: start;
    overflow: visible;
  }

  /* let calendar itself grow naturally */
  .calendar {
    min-height: auto;
  }

  /* small tweak so the whole page centers on large screens */
  body {
    display: flex;
    justify-content: center;
    align-items: flex-start;
    padding: 40px;
  }

  /* keep container width stable for nicer desktop layout */
  .calendar-container,
  .name-input-container,
  .level-dashboard {
    width: 900px;
    max-width: 90vw;
  }
}

.space-panel {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 18px;
  margin: 20px;
}

.space-btn {
  background: linear-gradient(145deg,#0a0f2c,#11184a);
  border: 1px solid rgba(255,255,255,0.15);
  border-radius: 18px;
  padding: 20px 10px;
  text-align: center;
  color: #e5e9ff;
  font-weight: 600;
  cursor: pointer;
  box-shadow:
    0 0 12px rgba(90,120,255,.3),
    inset 0 0 20px rgba(255,255,255,.05);
  backdrop-filter: blur(6px);
  transition: all .3s ease;
}

.space-btn span {
  display: block;
  margin-top: 6px;
  font-size: 13px;
  letter-spacing: .5px;
}

.space-btn:hover {
  transform: translateY(-4px) scale(1.03);
  box-shadow:
    0 0 25px rgba(120,150,255,.6),
    inset 0 0 25px rgba(255,255,255,.1);
}

.space-btn:active {
  transform: scale(.97);
}
/* COMMAND HUB FLOATING BUTTON */

.commandHub {
  position: fixed;
  bottom: 22px;
  right: 22px;
  z-index: 3000;
}

.profile-icon {
  width: 64px;
  height: 64px;
  border-radius: 50%;
  background: radial-gradient(circle at top,#7aa2ff,#0b1030);
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:26px;
  cursor:pointer;
  box-shadow:
    0 0 20px rgba(120,160,255,.6),
    inset 0 0 15px rgba(255,255,255,.15);
  transition:.3s;
}

.profile-icon:hover {
  transform: scale(1.05);
  box-shadow:
    0 0 30px rgba(140,180,255,.9);
}


/* OVERLAY */

.overlay {
  position: fixed;
  inset: 0;
  background: rgba(5,10,30,.6);
  backdrop-filter: blur(4px);
  opacity:0;
  pointer-events:none;
  transition:.3s;
}

.overlay.active {
  opacity:1;
  pointer-events:auto;
}


/* DRAWER */

.profile-drawer {
  position: fixed;
  bottom: 100px;
  right: 20px;
  width: 260px;
  background: linear-gradient(180deg,#0c1236,#05081f);
  border-radius: 18px;
  padding: 18px;
  box-shadow:0 0 35px rgba(120,150,255,.4);
  transform: translateY(40px) scale(.95);
  opacity:0;
  pointer-events:none;
  transition:.35s ease;
  z-index:3001;
  color:white;
}

.profile-drawer.open {
  opacity:1;
  transform: translateY(0) scale(1);
  pointer-events:auto;
}


/* DRAWER HEADER */

#drawerUserName {
  margin:0 0 15px;
  text-align:center;
  letter-spacing:.5px;
}

.close-drawer {
  position:absolute;
  right:12px;
  top:10px;
  cursor:pointer;
  font-size:20px;
  opacity:.7;
}


/* COMMAND ITEMS */

.profile-drawer div[id$="Icon"] {
  background:#0d143f;
  padding:12px;
  border-radius:12px;
  text-align:center;
  margin-bottom:10px;
  cursor:pointer;
  box-shadow: inset 0 0 12px rgba(255,255,255,.05);
  transition:.25s;
}

.profile-drawer div[id$="Icon"]:hover {
  transform: translateX(6px);
  box-shadow:0 0 15px rgba(120,160,255,.6);
}


<!-- Add this CSS to your <style> section -->

<style>
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ğŸš€ PREMIUM FLOATING COMMAND SPHERES - ULTRA LUXURY EDITION
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

.command-hub {
  position: fixed;
  bottom: 20px;
  left: 50%;
  transform: translateX(-50%);
  z-index: 5000;
  pointer-events: none;
}

.sphere-container {
  position: relative;
  width: 400px;
  height: 80px;
  pointer-events: all;
}

/* Master Control Sphere - The One Ring */
.master-sphere {
  position: absolute;
  bottom: 0;
  left: 50%;
  transform: translateX(-50%);
  width: 70px;
  height: 70px;
  border-radius: 50%;
  background: 
    radial-gradient(circle at 30% 30%, rgba(255,255,255,0.8), transparent 50%),
    radial-gradient(circle at 50% 50%, #667eea, #764ba2);
  box-shadow: 
    0 0 40px rgba(102, 126, 234, 0.8),
    0 0 80px rgba(118, 75, 162, 0.6),
    inset 0 0 20px rgba(255,255,255,0.3),
    0 10px 40px rgba(0,0,0,0.4);
  cursor: pointer;
  transition: all 0.6s cubic-bezier(0.34, 1.56, 0.64, 1);
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 32px;
  animation: masterPulse 4s ease-in-out infinite;
  backdrop-filter: blur(10px);
  border: 2px solid rgba(255,255,255,0.2);
}

.master-sphere::before {
  content: '';
  position: absolute;
  inset: -5px;
  border-radius: 50%;
  background: linear-gradient(45deg, transparent, rgba(255,255,255,0.3), transparent);
  animation: rotateBorder 3s linear infinite;
  z-index: -1;
}

.master-sphere::after {
  content: '';
  position: absolute;
  inset: 5px;
  border-radius: 50%;
  background: radial-gradient(circle at 30% 30%, rgba(255,255,255,0.4), transparent);
  animation: shimmer 2s ease-in-out infinite alternate;
}

.master-sphere:hover {
  transform: translateX(-50%) scale(1.15) translateY(-5px);
  box-shadow: 
    0 0 60px rgba(102, 126, 234, 1),
    0 0 120px rgba(118, 75, 162, 0.8),
    inset 0 0 30px rgba(255,255,255,0.5),
    0 15px 50px rgba(0,0,0,0.6);
  filter: brightness(1.2);
}

.master-sphere.active {
  transform: translateX(-50%) scale(0.95);
  box-shadow: 
    0 0 80px rgba(102, 126, 234, 1),
    0 0 160px rgba(118, 75, 162, 1),
    inset 0 0 40px rgba(255,255,255,0.6);
}

/* Command Spheres - The Satellites */
.command-sphere {
  position: absolute;
  bottom: 0;
  left: 50%;
  width: 55px;
  height: 55px;
  border-radius: 50%;
  cursor: pointer;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  font-size: 24px;
  transition: all 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);
  transform: translateX(-50%) scale(0);
  opacity: 0;
  backdrop-filter: blur(10px);
  border: 2px solid rgba(255,255,255,0.15);
  box-shadow: 
    0 5px 25px rgba(0,0,0,0.3),
    inset 0 0 20px rgba(255,255,255,0.1);
}

.command-sphere::before {
  content: '';
  position: absolute;
  inset: -3px;
  border-radius: 50%;
  opacity: 0;
  transition: opacity 0.3s ease;
  z-index: -1;
}

.command-sphere:hover::before {
  opacity: 1;
  animation: electricPulse 0.6s ease-in-out;
}

/* Individual Sphere Themes */
.sphere-cryptic {
  background: radial-gradient(circle at 30% 30%, rgba(255,193,7,0.3), transparent 70%),
              linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
}
.sphere-cryptic::before {
  background: linear-gradient(45deg, #f093fb, #f5576c, #f093fb);
  box-shadow: 0 0 30px #f5576c;
}

.sphere-wordle {
  background: radial-gradient(circle at 30% 30%, rgba(255,255,255,0.3), transparent 70%),
              linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
}
.sphere-wordle::before {
  background: linear-gradient(45deg, #4facfe, #00f2fe, #4facfe);
  box-shadow: 0 0 30px #00f2fe;
}

.sphere-leaderboard {
  background: radial-gradient(circle at 30% 30%, rgba(255,215,0,0.4), transparent 70%),
              linear-gradient(135deg, #fa709a 0%, #fee140 100%);
}
.sphere-leaderboard::before {
  background: linear-gradient(45deg, #fa709a, #fee140, #fa709a);
  box-shadow: 0 0 30px #fee140;
}

.sphere-vocab {
  background: radial-gradient(circle at 30% 30%, rgba(124,255,193,0.3), transparent 70%),
              linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
}
.sphere-vocab::before {
  background: linear-gradient(45deg, #a8edea, #fed6e3, #a8edea);
  box-shadow: 0 0 30px #a8edea;
}

.sphere-mystic {
  background: radial-gradient(circle at 30% 30%, rgba(186,85,211,0.4), transparent 70%),
              linear-gradient(135deg, #d299c2 0%, #fef9d7 100%);
}
.sphere-mystic::before {
  background: linear-gradient(45deg, #d299c2, #fef9d7, #d299c2);
  box-shadow: 0 0 30px #d299c2;
}

.sphere-stories {
  background: radial-gradient(circle at 30% 30%, rgba(76,175,80,0.3), transparent 70%),
              linear-gradient(135deg, #84fab0 0%, #8fd3f4 100%);
}
.sphere-stories::before {
  background: linear-gradient(45deg, #84fab0, #8fd3f4, #84fab0);
  box-shadow: 0 0 30px #84fab0;
}

/* Sphere Label */
.sphere-label {
  position: absolute;
  bottom: -25px;
  font-size: 10px;
  font-weight: 700;
  color: white;
  text-shadow: 0 2px 10px rgba(0,0,0,0.8);
  white-space: nowrap;
  letter-spacing: 0.5px;
  opacity: 0;
  transition: opacity 0.3s ease;
  pointer-events: none;
}

.command-sphere:hover .sphere-label {
  opacity: 1;
}

/* Active State Animations */
.spheres-active .command-sphere {
  transform: translateX(-50%) scale(1);
  opacity: 1;
}

.command-sphere:hover {
  transform: translateX(-50%) scale(1.2) translateY(-8px);
  box-shadow: 
    0 10px 40px rgba(0,0,0,0.4),
    0 0 60px currentColor,
    inset 0 0 30px rgba(255,255,255,0.3);
  filter: brightness(1.3);
}

.command-sphere:active {
  transform: translateX(-50%) scale(1.05) translateY(-4px);
}

/* Positioning for orbital effect */
.spheres-active .command-sphere:nth-child(1) { 
  transform: translateX(-50%) translateX(-200px) translateY(-20px) scale(1);
  transition-delay: 0.05s;
}
.spheres-active .command-sphere:nth-child(2) { 
  transform: translateX(-50%) translateX(-130px) translateY(-40px) scale(1);
  transition-delay: 0.1s;
}
.spheres-active .command-sphere:nth-child(3) { 
  transform: translateX(-50%) translateX(-65px) translateY(-50px) scale(1);
  transition-delay: 0.15s;
}
.spheres-active .command-sphere:nth-child(4) { 
  transform: translateX(-50%) translateX(0px) translateY(-55px) scale(1);
  transition-delay: 0.2s;
}
.spheres-active .command-sphere:nth-child(5) { 
  transform: translateX(-50%) translateX(65px) translateY(-50px) scale(1);
  transition-delay: 0.25s;
}
.spheres-active .command-sphere:nth-child(6) { 
  transform: translateX(-50%) translateX(130px) translateY(-40px) scale(1);
  transition-delay: 0.3s;
}
.spheres-active .command-sphere:nth-child(7) { 
  transform: translateX(-50%) translateX(200px) translateY(-20px) scale(1);
  transition-delay: 0.35s;
}

/* Hover adjustments for orbital spheres */
.spheres-active .command-sphere:nth-child(1):hover { 
  transform: translateX(-50%) translateX(-200px) translateY(-30px) scale(1.2);
}
.spheres-active .command-sphere:nth-child(2):hover { 
  transform: translateX(-50%) translateX(-130px) translateY(-50px) scale(1.2);
}
.spheres-active .command-sphere:nth-child(3):hover { 
  transform: translateX(-50%) translateX(-65px) translateY(-60px) scale(1.2);
}
.spheres-active .command-sphere:nth-child(4):hover { 
  transform: translateX(-50%) translateX(0px) translateY(-65px) scale(1.2);
}
.spheres-active .command-sphere:nth-child(5):hover { 
  transform: translateX(-50%) translateX(65px) translateY(-60px) scale(1.2);
}
.spheres-active .command-sphere:nth-child(6):hover { 
  transform: translateX(-50%) translateX(130px) translateY(-50px) scale(1.2);
}
.spheres-active .command-sphere:nth-child(7):hover { 
  transform: translateX(-50%) translateX(200px) translateY(-30px) scale(1.2);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   KEYFRAME ANIMATIONS - PREMIUM EFFECTS
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

@keyframes masterPulse {
  0%, 100% {
    box-shadow: 
      0 0 40px rgba(102, 126, 234, 0.8),
      0 0 80px rgba(118, 75, 162, 0.6),
      inset 0 0 20px rgba(255,255,255,0.3),
      0 10px 40px rgba(0,0,0,0.4);
  }
  50% {
    box-shadow: 
      0 0 60px rgba(102, 126, 234, 1),
      0 0 120px rgba(118, 75, 162, 0.8),
      inset 0 0 30px rgba(255,255,255,0.5),
      0 10px 40px rgba(0,0,0,0.4);
  }
}

@keyframes rotateBorder {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}

@keyframes shimmer {
  0% { opacity: 0.3; }
  100% { opacity: 0.8; }
}

@keyframes electricPulse {
  0%, 100% { 
    filter: blur(0px);
    transform: scale(1);
  }
  50% { 
    filter: blur(5px);
    transform: scale(1.3);
  }
}

@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-10px); }
}

/* Mobile Responsiveness */
@media (max-width: 768px) {
  .sphere-container {
    width: 100%;
    max-width: 350px;
  }
  
  .master-sphere {
    width: 60px;
    height: 60px;
    font-size: 28px;
  }
  
  .command-sphere {
    width: 45px;
    height: 45px;
    font-size: 20px;
  }
  
  .spheres-active .command-sphere:nth-child(1) { 
    transform: translateX(-50%) translateX(-160px) translateY(-15px) scale(0.9);
  }
  .spheres-active .command-sphere:nth-child(2) { 
    transform: translateX(-50%) translateX(-105px) translateY(-30px) scale(0.9);
  }
  .spheres-active .command-sphere:nth-child(3) { 
    transform: translateX(-50%) translateX(-52px) translateY(-38px) scale(0.9);
  }
  .spheres-active .command-sphere:nth-child(4) { 
    transform: translateX(-50%) translateX(0px) translateY(-42px) scale(0.9);
  }
  .spheres-active .command-sphere:nth-child(5) { 
    transform: translateX(-50%) translateX(52px) translateY(-38px) scale(0.9);
  }
  .spheres-active .command-sphere:nth-child(6) { 
    transform: translateX(-50%) translateX(105px) translateY(-30px) scale(0.9);
  }
  .spheres-active .command-sphere:nth-child(7) { 
    transform: translateX(-50%) translateX(160px) translateY(-15px) scale(0.9);
  }
}

/* Particle Effect Background (optional enhancement) */
.sphere-particles {
  position: absolute;
  inset: 0;
  pointer-events: none;
  overflow: hidden;
  z-index: -1;
}

.particle {
  position: absolute;
  width: 3px;
  height: 3px;
  background: white;
  border-radius: 50%;
  animation: particleFloat 3s ease-in-out infinite;
  opacity: 0;
}

@keyframes particleFloat {
  0%, 100% { 
    opacity: 0;
    transform: translateY(0) scale(0);
  }
  50% { 
    opacity: 0.8;
    transform: translateY(-50px) scale(1);
  }
}

</style>
</head>
<body>
<div id="miniPowerDeckTop"
   onclick="toggleTimeMode()"
     style="
       text-align:center;
       font-size:0.95rem;
       font-weight:600;
       color:white;
       padding:6px 0;
       margin-top:10px;
       margin-bottom:8px;
       border-radius:10px;
       width:90%;
       max-width:500px;
       margin-left:auto;
       margin-right:auto;
       background:rgba(0,0,0,0.25);
       backdrop-filter:blur(6px);
       box-shadow:0 3px 10px rgba(0,0,0,0.2);
     ">
</div>


<div class="loading-screen" id="loadingScreen">
  <h1>Loading your Quest Calendar...</h1>
  <div class="spinner"></div>
  <p class="credits"> Created with â™¥ï¸ grit, nurtured with love and charged with passion by 
<a href="https://andrewveda.github.io/" 
   style="color:#7A0019; font-weight:600; text-decoration:none;" 
   target="_blank">
   Andrew Veda
</a> <br>SRM Valliammai Engineering College
</p>
</div>

<div class="name-input-container" id="nameInputContainer">
  <h1>SRM Valliammai Engineering College (Autonomous)</h1>
  <h2>Department of English</h2>
  <input type="text" id="nameInput" placeholder="Enter Your Name">
  <button class="btn-primary" onclick="saveAndLogin()">Get Started</button>
  <a href="https://sites.google.com/view/srm-vec-english/daily-vocabulary">
    <button class="btn-vocab">ğŸ“š Daily Vocabulary</button>
  </a>
  <a href="https://andrewveda.github.io/SRM-VEC-English-PWA/buttons/brochure1">
    <button class="btn-mystic">ğŸ¯ Register for Mystic Summit</button>
  </a>
  <a href="https://andrewveda.github.io/SRM-VEC-English-PWA/buttons/fun">
    <button class="btn-wordle">ğŸ‘½ WORDLE!</button>
  </a>
  <a href="https://andrewveda.github.io/SRM-VEC-English-PWA/buttons/leaderboard">
    <button class="btn-leaderboard">ğŸ˜ Leaderboard</button>
  </a>
  <a href="https://andrewveda.github.io/SRM-VEC-English-PWA/buttons/ELLL.html">
    <button class="btn-elll">ğŸ“ ELLL Virtual Recordâœ¨ </button>
  </a>
</div>

<!-- Add this HTML before closing </body> tag, REPLACE your existing profile-icon/drawer setup -->

<div class="command-hub">
  <div class="sphere-container" id="sphereContainer">
    
    <!-- Command Spheres (hidden by default) -->
    <div class="command-sphere sphere-cryptic" onclick="window.location.href='https://andrewveda.github.io/SRM-VEC-English-PWA/buttons/fun'">
      ğŸ”®
      <span class="sphere-label">CRYPTIC</span>
    </div>
    
    <div class="command-sphere sphere-wordle" onclick="window.location.href='https://andrewveda.github.io/SRM-VEC-English-PWA/buttons/fun'">
      ğŸ¯
      <span class="sphere-label">WORDLE</span>
    </div>
    
    <div class="command-sphere sphere-leaderboard" onclick="window.location.href='https://andrewveda.github.io/SRM-VEC-English-PWA/buttons/leaderboard'">
      ğŸ‘‘
      <span class="sphere-label">LEADERBOARD</span>
    </div>
    
    <div class="command-sphere sphere-vocab" onclick="window.location.href='https://sites.google.com/view/srm-vec-english/daily-vocabulary'">
      ğŸ“š
      <span class="sphere-label">VOCABULARY</span>
    </div>
    
    <div class="command-sphere sphere-mystic" onclick="window.location.href='https://andrewveda.github.io/SRM-VEC-English-PWA/buttons/brochure1'">
      ğŸª
      <span class="sphere-label">MYSTIC</span>
    </div>
    
    <div class="command-sphere sphere-stories" onclick="switchType('story')">
      ğŸ“–
      <span class="sphere-label">STORIES</span>
    </div>
    
    <div class="command-sphere" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);" onclick="toggleDrawer()">
      ğŸ‘¤
      <span class="sphere-label">PROFILE</span>
    </div>
    
    <!-- Master Control Sphere -->
    <div class="master-sphere" id="masterSphere">
      ğŸš€
    </div>
    
  </div>
</div>
<div class="calendar-container" id="calendarContainer">
  <div class="offline-banner" id="offlineBanner">ğŸ“¡ Offline mode â€” progress will sync when online.</div>
 
  <div class="user-info">
    <h2 id="userName"></h2>
  </div>

<div class="type-buttons">
  <button class="type-button active" style="background:#2196F3;" onclick="switchType('quest')">ğŸ“ Reach for the stars with the Daily Quest! </button>
  <button class="type-button" style="background:#E53935;" onclick="switchType('video')">ğŸ¥ Videos</button>
  <button class="type-button" style="background:#4CAF50;" onclick="switchType('story')">ğŸ“š Stories</button>
</div>

  <div class="calendar">
    <div class="calendar-header">
      <button onclick="changeMonth(-1)">â—€</button>
      <div id="monthYear"></div>
      <button onclick="changeMonth(1)">â–¶</button>
    </div>
    <div class="days-of-week">
      <div>Sun</div><div>Mon</div><div>Tue</div><div>Wed</div>
      <div>Thu</div><div>Fri</div><div>Sat</div>
    </div>
    <div class="dates" id="datesGrid"></div>
  </div>
 
<div class="quotes-carousel" id="quotesCarousel">
  <p>"Ever tried. Ever failed. No matter. Try again. Fail again. Fail better." <br> â€” Samuel Beckett</p>
</div>
 
  <p style="text-align: center; font-size: 0.8rem; color: #888; margin-top: 15px; padding-bottom: 5px; flex-shrink: 0;">
    Created with â™¥ï¸ grit, nurtured with love and charged with passion by 
<a href="https://andrewveda.github.io/" 
   style="color:#7A0019; font-weight:600; text-decoration:none;" 
   target="_blank">
   Andrew Veda
</a> <br>SRM Valliammai Engineering College
  </p>
</div>

<div id="customModal" class="custom-modal-overlay">
  <div class="custom-modal">
    <p id="modalMessage">Are you sure?</p>
    <div class="modal-buttons">
      <button id="modalCancel" class="modal-btn modal-btn-cancel">Cancel</button>
      <button id="modalConfirm" class="modal-btn modal-btn-confirm">OK</button>
    </div>
  </div>
</div>

<script type="module">
  import { createClient } from "https://esm.sh/@supabase/supabase-js@2";

  // ğŸ”¥ GLOBAL RESET â€” RUNS ONCE FOR ALL USERS
  const RESET_VERSION = "2025-11-29-v1";

  if (localStorage.getItem("RESET_VERSION") !== RESET_VERSION) {
      console.log("ğŸ”¥ Global reset triggered â€” clearing old cached data.");

      // Remove all old cached data keys
      localStorage.removeItem("cachedProfileData");
      localStorage.removeItem("cachedUserData");
      localStorage.removeItem("userName");
      localStorage.removeItem("pendingSync");

      // Mark reset done
      localStorage.setItem("RESET_VERSION", RESET_VERSION);
  }

  const supabase = createClient(
    "https://ahezssoczvpbkteffcgz.supabase.co", 
    "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImFoZXpzc29jenZwYmt0ZWZmY2d6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjI4NTk1ODUsImV4cCI6MjA3ODQzNTU4NX0.2ZlqXnZxv0opkhynAT7OlK4S-xPygcc7ETUyTXRfGHE"
  );

let sessionStartTime = Date.now();
let totalTimeSpent = 0; // This is session time, not total
let userData = null;
let userProfileData = null;
  let showHHMMSS = false;

let currentMonth = new Date().getMonth();
let currentYear = new Date().getFullYear();
let currentType = 'quest';
const startDate = new Date(2025, 7, 25); // Note: Months are 0-indexed (7 = August)

const questLinks = {
  1: "https://andrewveda.github.io/SRM-VEC-English-PWA/quests/quest1", 2: "https://sites.google.com/view/srm-vec-english/quest/wh-questions-1",
  3: "https://sites.google.com/view/cys-english/self-introduction-1", 4: "https://sites.google.com/view/srm-vec-english/quest/one-word-substitution-1",
  5: "https://sites.google.com/view/cys-english/self-introduction-3", 6: "https://sites.google.com/view/srm-vec-english/quest/film-review",
  7: "https://sites.google.com/view/srm-vec-english/quest/pronouns-1", 8: "https://sites.google.com/view/srm-vec-english/quest/pronouns-2",
  9: "https://sites.google.com/view/srm-vec-english/quest/parts-of-speech-1", 10: "https://sites.google.com/view/srm-vec-english/quest/question-tags-1",
  11: "https://sites.google.com/view/srm-vec-english/quest/question-tags-2", 12: "https://sites.google.com/view/srm-vec-english/quest/subject-verb-agreement",
  13: "https://sites.google.com/view/srm-vec-english/quest/comparative-1", 14: "https://sites.google.com/view/srm-vec-english/quest/comparative-2",
  15: "https://sites.google.com/view/srm-vec-english/quest/discourse-markers", 16: "https://sites.google.com/view/srm-vec-english/quest/past-1",
  17: "https://sites.google.com/view/cys-english/questyesno1", 18: "https://sites.google.com/view/srm-vec-english/quest/yesno-2",
  19: "https://sites.google.com/view/srm-vec-english/quest/one-word-substitution-2", 20: "https://sites.google.com/view/cys-english/match1",
  21: "https://sites.google.com/view/cys-english/match2", 22: "https://sites.google.com/view/cys-english/past",
  23: "https://andrewveda.github.io/SRM-VEC-English-PWA/buttons/MCQ/Homophone1", 
  24: "https://andrewveda.github.io/SRM-VEC-English-PWA/buttons/MCQ/Homophone2",
  25: "https://sites.google.com/view/cys-english/comparisons1", 26: "https://sites.google.com/view/cys-english/comparisons2",
  27: "https://sites.google.com/view/cys-english/discoursemarkers", 
  28: "https://andrewveda.github.io/SRM-VEC-English-PWA/buttons/MCQ/article1",
  29: "https://sites.google.com/view/cys-english/synonym1", 30: "https://sites.google.com/view/cys-english/synonym2",
  31: "https://sites.google.com/view/cys-english/antonym1", 32: "https://sites.google.com/view/cys-english/antonym2",
  33: "https://sites.google.com/view/cys-english/prep1", 34: "https://sites.google.com/view/cys-english/prep2",
  35: "https://sites.google.com/view/cys-english/past2", 36: "https://sites.google.com/view/cys-english/prep3",
  37: "https://sites.google.com/view/cys-english/match3", 
  38: "https://andrewveda.github.io/SRM-VEC-English-PWA/buttons/MCQ/article2",
  39: "https://andrewveda.github.io/SRM-VEC-English-PWA/buttons/MCQ/article3", 
  40: "https://sites.google.com/view/cys-english/quest40", 
  41: "https://andrewveda.github.io/SRM-VEC-English-PWA/buttons/MCQ/present1", 
42: "https://andrewveda.github.io/SRM-VEC-English-PWA/buttons/MCQ/tense1", 
43: "https://andrewveda.github.io/SRM-VEC-English-PWA/buttons/MCQ/tense2", 
44: "https://sites.google.com/view/cys-english/quest44",
  45: "https://sites.google.com/view/cys-english/quest45", 46: "https://sites.google.com/view/cys-english/quest46",
  47: "https://sites.google.com/view/cys-english/quest47", 
  48: "https://andrewveda.github.io/SRM-VEC-English-PWA/buttons/MCQ/collocation1", 
  49: "https://sites.google.com/view/cys-english/quest49", 
  50: "https://sites.google.com/view/cys-english/quest50",
  51: "https://sites.google.com/view/cys-english/quest51", 
    52: "https://sites.google.com/view/cys-english/quest52",
    53: "https://sites.google.com/view/cys-english/quest53",
    54: "https://sites.google.com/view/cys-english/quest54",
    55: "https://sites.google.com/view/cys-english/quest55",
    56: "https://sites.google.com/view/cys-english/quest56",
    57: "https://sites.google.com/view/cys-english/quest57",
    58: "https://sites.google.com/view/cys-english/quest58",
    59: "https://sites.google.com/view/cys-english/quest59",
    60: "https://sites.google.com/view/cys-english/quest60",
    61: "https://sites.google.com/view/cys-english/quest61",
    62: "https://sites.google.com/view/cys-english/quest62",
    63: "https://sites.google.com/view/cys-english/full-streak-wh-questions", 
    64: "https://sites.google.com/view/cys-english/full-streak-single-word",
  65: "https://sites.google.com/view/cys-english/full-streak-3", 
  66: "https://sites.google.com/view/cys-english/full-streak-4",
  67: "https://sites.google.com/view/cys-english/full-streak-5", 
  68: "https://sites.google.com/view/cys-english/full-streak-6",
  69: "https://sites.google.com/view/cys-english/full-streak-7", 
  70: "https://andrewveda.github.io/SRM-VEC-English-PWA/cloze/bookreview1", 
  71: "https://andrewveda.github.io/SRM-VEC-English-PWA/cloze/bookreview2", 
  72: "https://andrewveda.github.io/SRM-VEC-English-PWA/cloze/bookreview3", 
  73: "https://andrewveda.github.io/SRM-VEC-English-PWA/cloze/bookreview4", 
  74: "https://andrewveda.github.io/SRM-VEC-English-PWA/cloze/blog1", 
  75: "https://andrewveda.github.io/SRM-VEC-English-PWA/cloze/blog2",
  76: "https://andrewveda.github.io/SRM-VEC-English-PWA/cloze/blog3",
  77: "https://andrewveda.github.io/SRM-VEC-English-PWA/cloze/blog4",
  78: "https://andrewveda.github.io/SRM-VEC-English-PWA/cloze/blog5",
  79: "https://andrewveda.github.io/SRM-VEC-English-PWA/cloze/blog6",
  80: "https://andrewveda.github.io/SRM-VEC-English-PWA/cloze/blog7",
  81: "https://andrewveda.github.io/SRM-VEC-English-PWA/cloze/blog8",
  82: "https://andrewveda.github.io/SRM-VEC-English-PWA/cloze/blog9",
  83: "https://andrewveda.github.io/SRM-VEC-English-PWA/cloze/blog10",
  84: "https://andrewveda.github.io/SRM-VEC-English-PWA/cloze/blog11",
  85: "https://andrewveda.github.io/SRM-VEC-English-PWA/cloze/blog12",
  86: "https://andrewveda.github.io/SRM-VEC-English-PWA/cloze/blog13",
  87: "https://andrewveda.github.io/SRM-VEC-English-PWA/cloze/blog14",
  88: "https://andrewveda.github.io/SRM-VEC-English-PWA/cloze/blog15",
  89: "https://andrewveda.github.io/SRM-VEC-English-PWA/cloze/blog16",
  90: "https://andrewveda.github.io/SRM-VEC-English-PWA/cloze/blog17",
  91: "https://andrewveda.github.io/SRM-VEC-English-PWA/cloze/blog18",
  92: "https://andrewveda.github.io/SRM-VEC-English-PWA/cloze/instructions1",
  93: "https://andrewveda.github.io/SRM-VEC-English-PWA/cloze/instructions2",
  94: "https://andrewveda.github.io/SRM-VEC-English-PWA/cloze/expandcompoundnoun",
  95: "https://andrewveda.github.io/SRM-VEC-English-PWA/cloze/report1",
  96: "https://andrewveda.github.io/SRM-VEC-English-PWA/cloze/report2",
  97: "https://andrewveda.github.io/SRM-VEC-English-PWA/cloze/report3",
  98: "https://andrewveda.github.io/SRM-VEC-English-PWA/cloze/report4",
  99: "https://andrewveda.github.io/SRM-VEC-English-PWA/cloze/report5",
  100: "https://andrewveda.github.io/SRM-VEC-English-PWA/cloze/report6",
  101: "https://andrewveda.github.io/SRM-VEC-English-PWA/cloze/report7",
  102: "https://andrewveda.github.io/SRM-VEC-English-PWA/buttons/MCQ/questions1",
  103: "https://andrewveda.github.io/SRM-VEC-English-PWA/buttons/MCQ/negative",
  104: "https://andrewveda.github.io/SRM-VEC-English-PWA/buttons/MCQ/compound",
  105: "https://andrewveda.github.io/SRM-VEC-English-PWA/buttons/MCQ/compound2",
  106: "https://andrewveda.github.io/SRM-VEC-English-PWA/buttons/MCQ/punctuation1",
  107: "https://andrewveda.github.io/SRM-VEC-English-PWA/buttons/MCQ/punctuation2",
  108: "https://andrewveda.github.io/SRM-VEC-English-PWA/buttons/MCQ/functionwords1",
  109: "https://andrewveda.github.io/SRM-VEC-English-PWA/buttons/MCQ/functionwords2",
  110: "https://andrewveda.github.io/3/Pygmalion",
  111: "https://andrewveda.github.io/SRM-VEC-English-PWA/buttons/videoqueststed",
  112: "https://andrewveda.github.io/SRM-VEC-English-PWA/buttons/videoquestspodcast",
  113: "https://andrewveda.github.io/SRM-VEC-English-PWA/cloze/invention1",
  114: "https://andrewveda.github.io/SRM-VEC-English-PWA/cloze/invention2",
  115: "https://andrewveda.github.io/SRM-VEC-English-PWA/cloze/invention3",
  116: "https://andrewveda.github.io/SRM-VEC-English-PWA/cloze/invention4",
  117: "https://andrewveda.github.io/SRM-VEC-English-PWA/cloze/invention5",
  118: "https://andrewveda.github.io/SRM-VEC-English-PWA/cloze/invention6",
  119: "https://andrewveda.github.io/SRM-VEC-English-PWA/cloze/invention7",
  120: "https://andrewveda.github.io/SRM-VEC-English-PWA/buttons/MCQ/tensematch1",
  121: "https://andrewveda.github.io/SRM-VEC-English-PWA/buttons/MCQ/tensematch2",
  122: "https://andrewveda.github.io/SRM-VEC-English-PWA/buttons/MCQ/tensematch3",
  123: "https://andrewveda.github.io/SRM-VEC-English-PWA/buttons/MCQ/tensematch4",
  124: "https://andrewveda.github.io/SRM-VEC-English-PWA/buttons/MCQ/tensematch5",
  125: "https://andrewveda.github.io/SRM-VEC-English-PWA/buttons/MCQ/tensematch6",
  126: "https://andrewveda.github.io/SRM-VEC-English-PWA/buttons/MCQ/t4",
  127: "https://andrewveda.github.io/SRM-VEC-English-PWA/buttons/MCQ/t3",
  128: "https://andrewveda.github.io/SRM-VEC-English-PWA/buttons/MCQ/t2negquesprestense",
  129: "https://andrewveda.github.io/SRM-VEC-English-PWA/buttons/MCQ/homophonearticles",
  130: "https://andrewveda.github.io/SRM-VEC-English-PWA/cloze/Quotes1",
  131: "https://andrewveda.github.io/SRM-VEC-English-PWA/cloze/quotes2",
  132: "https://andrewveda.github.io/SRM-VEC-English-PWA/buttons/MCQ/idiom1",
  133: "https://andrewveda.github.io/SRM-VEC-English-PWA/buttons/MCQ/idiom2",
  134: "https://andrewveda.github.io/SRM-VEC-English-PWA/buttons/MCQ/idiom3",
  135: "https://andrewveda.github.io/SRM-VEC-English-PWA/buttons/MCQ/idiom4",
  

};
const videoLink = "https://andrewveda.github.io/SRM-VEC-English-PWA/buttons/videoquests";
const storyLinks = { 69: "https://andrewveda.github.io/SRM-VEC-English-PWA/cloze/story1", 
                    70: "https://andrewveda.github.io/SRM-VEC-English-PWA/cloze/story2", 
                    71: "https://andrewveda.github.io/SRM-VEC-English-PWA/cloze/story3", 
                    72: "https://andrewveda.github.io/SRM-VEC-English-PWA/cloze/story4", 
                    73: "https://andrewveda.github.io/SRM-VEC-English-PWA/cloze/story5", 
                    74: "https://andrewveda.github.io/SRM-VEC-English-PWA/cloze/story6", 
                    75: "https://andrewveda.github.io/SRM-VEC-English-PWA/cloze/story7", 
                    76: "https://andrewveda.github.io/SRM-VEC-English-PWA/cloze/story8",
                      77: "https://andrewveda.github.io/SRM-VEC-English-PWA/cloze/story9",
                      78: "https://andrewveda.github.io/SRM-VEC-English-PWA/cloze/story10",
                      79: "https://andrewveda.github.io/SRM-VEC-English-PWA/cloze/story11",
                      80: "https://andrewveda.github.io/SRM-VEC-English-PWA/cloze/story12",
                      81: "https://andrewveda.github.io/SRM-VEC-English-PWA/cloze/story13",
                      82: "https://andrewveda.github.io/SRM-VEC-English-PWA/cloze/story14",
                      83: "https://andrewveda.github.io/SRM-VEC-English-PWA/cloze/story15",
                      84: "https://andrewveda.github.io/SRM-VEC-English-PWA/cloze/story16",
                      85: "https://andrewveda.github.io/SRM-VEC-English-PWA/cloze/story17",
                      86: "https://andrewveda.github.io/SRM-VEC-English-PWA/cloze/story18",
                      87: "https://andrewveda.github.io/SRM-VEC-English-PWA/cloze/story19",
                      88: "https://andrewveda.github.io/SRM-VEC-English-PWA/cloze/story20",
                      89: "https://andrewveda.github.io/SRM-VEC-English-PWA/cloze/story21",
                      90: "https://andrewveda.github.io/SRM-VEC-English-PWA/cloze/story22",
                      91: "https://andrewveda.github.io/SRM-VEC-English-PWA/cloze/story23",
                      92: "https://andrewveda.github.io/SRM-VEC-English-PWA/cloze/story24",
                      93: "https://andrewveda.github.io/SRM-VEC-English-PWA/cloze/story25",
                      94: "https://andrewveda.github.io/SRM-VEC-English-PWA/cloze/story26",
                      95: "https://andrewveda.github.io/SRM-VEC-English-PWA/cloze/story27",
                      96: "https://andrewveda.github.io/SRM-VEC-English-PWA/cloze/story28",
                      97: "https://andrewveda.github.io/SRM-VEC-English-PWA/cloze/story29",
                      98: "https://andrewveda.github.io/SRM-VEC-English-PWA/cloze/story30",
                      99: "https://andrewveda.github.io/SRM-VEC-English-PWA/cloze/story31"
                      
                       
                      }

async function init() {
  const savedName = localStorage.getItem('userName');
  
  if (savedName) {
    const cachedUser = localStorage.getItem('cachedUserData');
    const cachedProfile = localStorage.getItem('cachedProfileData');
    
    if (cachedUser && cachedProfile) {
      // Load from cache for instant startup
      userData = JSON.parse(cachedUser);
      userProfileData = JSON.parse(cachedProfile);
      showCalendar(); // Show UI immediately
      
      // Refresh data in the background
      refreshData(savedName); 
    } else {
      // No cache, show loading screen and fetch
      document.getElementById('loadingScreen').classList.add('show');
      await fetchInitialData(savedName);
      showCalendar();
      document.getElementById('loadingScreen').classList.remove('show');
    }
  } else {
    // New user
    document.getElementById('nameInputContainer').classList.add('show');
  }
  
  setupEventListeners();
  checkOnlineStatus();
  trackInstall();
}

/**
 * Fetches all necessary data from Supabase. Used for initial login.
 * Shows loading screen.
 */
async function fetchInitialData(name) {
  console.log("Fetching initial data for:", name);
  try {
    const [summaryResult, leaderboardResult] = await Promise.all([
      supabase.from('summary_import').select('*'),
      supabase.from('leaderboard').select('*')
    ]);

    if (summaryResult.error) throw summaryResult.error;
    if (leaderboardResult.error) throw leaderboardResult.error;

    // Find user in summary data
   // Find user in summary data
userData = summaryResult.data.find(u => 
  u.student_name && u.student_name.toUpperCase().includes(name.toUpperCase())
) || { student_name: name.toUpperCase(), quest_list: "", video_list: "", story_list: "" }; // Default object

// ğŸ” NEW LOG HERE
console.log("ğŸ” INITIAL quest_list received:", userData.quest_list);
// Strict EXACT match â€” no normalization
const profileUser = leaderboardResult.data.find(u =>
  u.Name &&
  u.Name.trim().toLowerCase() === name.trim().toLowerCase()
);

userProfileData = profileUser || {
  Name: name,
  Correct: 0,
  Wrong: 0,
  "Total Time (s)": 0,
  Rank: "-"
};


console.log("Loaded userProfileData (fetchInitialData):", userProfileData);
    // Cache results
    localStorage.setItem('cachedUserData', JSON.stringify(userData));
    localStorage.setItem('cachedProfileData', JSON.stringify(userProfileData));

  } catch (err) {
    console.error('Error loading initial data:', err);
    showModal('Error loading data. Please check your connection and try again.', () => {
      document.getElementById('loadingScreen').classList.remove('show');
      document.getElementById('nameInputContainer').classList.add('show');
    });
  }
}

/**
 * Refreshes data in the background without a loading screen.
 */
async function refreshData(name) {
  if (!name) return;
  console.log("Refreshing data in background for:", name);
  try {
    const [summaryResult, leaderboardResult] = await Promise.all([
      supabase.from('summary_import').select('*'),
      supabase.from('leaderboard').select('*')
    ]);

    if (summaryResult.error) throw summaryResult.error;
    if (leaderboardResult.error) throw leaderboardResult.error;

    // Find user in summary data
    const summaryUser = summaryResult.data.find(u => 
      u.student_name && u.student_name.toUpperCase().includes(name.toUpperCase())
    );
    if (summaryUser) {
      userData = summaryUser;
       console.log("ğŸ” SUMMARY quest_list received:", summaryUser.quest_list);
      localStorage.setItem('cachedUserData', JSON.stringify(userData));
    }

    // Find user in leaderboard data
// Strict EXACT match â€” no uppercase, no startsWith
const profileUser = leaderboardResult.data.find(u =>
  u.Name &&
  u.Name.trim().toLowerCase() === name.trim().toLowerCase()
);

if (profileUser) {
  userProfileData = profileUser;
  localStorage.setItem('cachedProfileData', JSON.stringify(userProfileData));
}
  
console.log("Loaded userProfileData (refreshData):", userProfileData);
    // Update UI with new data
    updateAllUI();

  } catch (err) {
    console.error('Error refreshing data:', err);
    // Don't show modal, just log error and keep using cached data
    document.getElementById('offlineBanner').classList.add('show');
  }
}


function setupEventListeners() {
  document.getElementById('profileIcon').addEventListener('click', toggleDrawer);
  document.getElementById('closeDrawer').addEventListener('click', toggleDrawer);
  document.getElementById('overlay').addEventListener('click', toggleDrawer);
 
  window.addEventListener('beforeunload', syncData);
  window.addEventListener('online', handleOnline);
  window.addEventListener('offline', handleOffline);

  document.addEventListener('visibilitychange', async () => {
    if (document.hidden) {
      syncData();
    } else {
      sessionStartTime = Date.now();
      // Refresh data when user returns to tab
      const savedName = localStorage.getItem("userName");
      if (savedName) {
        refreshData(savedName); 
      }
    }
  });
  
  // Removed session time tracking interval, handled by syncData on close

  document.getElementById('modalConfirm').addEventListener('click', () => {
    if (window.confirmCallback) {
      window.confirmCallback();
    }
    document.getElementById('customModal').classList.remove('show');
    window.confirmCallback = null;
  });

  document.getElementById('modalCancel').addEventListener('click', () => {
    document.getElementById('customModal').classList.remove('show');
    window.confirmCallback = null;
  });

  document.getElementById("leaderboardIcon").onclick = () => {
    window.location.href = "https://andrewveda.github.io/SRM-VEC-English-PWA/buttons/leaderboard_live";
  };
  document.getElementById("elllIcon").onclick = () => {
    window.location.href = "https://andrewveda.github.io/SRM-VEC-English-PWA/buttons/fun";
  };
}


function showModal(message, onConfirm) {
  const modal = document.getElementById('customModal');
  document.getElementById('modalMessage').textContent = message;
  modal.classList.add('show');
  window.confirmCallback = onConfirm;
}

function toggleDrawer() {
  const drawer = document.getElementById('profileDrawer');
  const overlay = document.getElementById('overlay');

  drawer.classList.toggle('open');
  overlay.classList.toggle('active');

  // Update name in drawer when opened (it might have been "Loading...")
  if (drawer.classList.contains('open')) {
    updateProfileDrawer();
  }
}


async function saveAndLogin() {
  const name = document.getElementById('nameInput').value.trim();
  if (!name) {
    showModal('Please enter your name!', () => {});
    return;
  }
 
  const upperCaseName = name.toUpperCase();
  localStorage.setItem('userName', upperCaseName);
 
  document.getElementById('nameInputContainer').classList.remove('show');
  document.getElementById('loadingScreen').classList.add('show');

  // Perform the first-time data fetch
  await fetchInitialData(upperCaseName);
  
  showCalendar();
  
  document.getElementById('loadingScreen').classList.remove('show');
}


function showCalendar() {
  document.getElementById('calendarContainer').classList.add('show');
  document.getElementById('profileIcon').classList.add('show');
  
  // Update all UI components that depend on data
  updateAllUI();
}
  
async function loadTotalTime(name) {
  const { data, error } = await supabase
    .from('report_card_view')
    .select('*')
    .ilike('name', `${name}%`);  

  if (error) {
    console.error("Error loading total_time:", error);
    return 0;
  }

  if (!data || data.length === 0) return 0;

  return data[0].total_time || 0;
}
  function toggleTimeMode() {
  showHHMMSS = !showHHMMSS;
  updateMiniPowerDeck();
}
window.toggleTimeMode = toggleTimeMode;
  async function updateMiniPowerDeck() {
  if (!userData || !userProfileData) return;
    
  const questCount = parseList(userData.quest_list).length;
  const videoCount = parseList(userData.video_list).length;
  const storyCount = parseList(userData.story_list).length;
  console.log("MiniDeck profile data:", userProfileData);
  console.log("total_time field value:", userProfileData?.total_time);
  // â­ The correct field from your Supabase report_card_view
 const totalTimeSeconds = await loadTotalTime(userProfileData.Name);
  // Convert to human-friendly m/s
  const minutes = Math.floor(totalTimeSeconds / 60);
  const seconds = totalTimeSeconds % 60;
let formattedTime;

if (!showHHMMSS) {
  formattedTime = `${totalTimeSeconds}s`;
} else {
  const h = Math.floor(totalTimeSeconds / 3600);
  const m = Math.floor((totalTimeSeconds % 3600) / 60);
  const s = totalTimeSeconds % 60;

  formattedTime =
    `${h.toString().padStart(2, '0')}h ` +
    `${m.toString().padStart(2, '0')}m ` +
    `${s.toString().padStart(2, '0')}s`;
}
  const text = `
    ğŸ“ ${questCount} &nbsp;&nbsp;&nbsp;
    ğŸ¥ ${videoCount} &nbsp;&nbsp;&nbsp;
    ğŸ“š ${storyCount} &nbsp;&nbsp;&nbsp;
    â±ï¸ ${formattedTime}
  `;

  const topEl = document.getElementById("miniPowerDeckTop");
  if (topEl) topEl.innerHTML = text;
}


  function updateAllUI() {
  if (!userData || !userProfileData) return;
  
  const displayName = userProfileData?.Name || userData?.student_name || 'Unknown';
  document.getElementById('userName').textContent = displayName;

  updateProfileDrawer();
  updateMiniPowerDeck();
  renderCalendar(currentMonth, currentYear, currentType);
}

function parseList(raw) {
  if (!raw) return [];
  return raw
    .split(",")
    .map(x => x.trim())
    .filter(x => x.length > 0)
    .map(x => x.replace(/\s+/g, "").toLowerCase()); // Normalize: "Quest 1" -> "quest1"
}

/**
 * Updates the Profile Drawer (now just the name).
 */
function updateProfileDrawer() {
  if (!userData && !userProfileData) return;

  const name =
    userProfileData?.Name ||
    userData?.student_name ||
    "User";

  document.getElementById("drawerUserName").textContent = name;
  // All stat-related code removed.
}

/**
 * Updates the Level Dashboard with stats.
 */
// REMOVED entire updateLevelDashboard function
/*
function updateLevelDashboard() {
  if (!userData || !userProfileData) return;
...
  document.getElementById("powerTimeFill").style.width = `${Math.min(100, (timeMin / maxTime) * 100)}%`;
}
*/


function switchType(type) {
  currentType = type;
  document.querySelectorAll('.type-button').forEach(btn => btn.classList.remove('active'));
  event.target.classList.add('active');
  renderCalendar(currentMonth, currentYear, currentType);
}

function changeMonth(direction) {
  currentMonth += direction;
  if (currentMonth < 0) {
    currentMonth = 11;
    currentYear--;
  } else if (currentMonth > 11) {
    currentMonth = 0;
    currentYear++;
  }
  renderCalendar(currentMonth, currentYear, currentType);
}

function renderCalendar(month, year, type) {
  // console.group(`ğŸ“… Calendar Debug â€” ${type.toUpperCase()} â€” ${month+1}/${year}`);
  
  const datesGrid = document.getElementById('datesGrid');
  const monthYear = document.getElementById('monthYear');

  const daysInMonth = new Date(year, month + 1, 0).getDate();
  monthYear.textContent = new Date(year, month).toLocaleString('default', {
    month: 'long'
  }) + ' ' + year;

  datesGrid.innerHTML = '';

  // Pad empty cells
  const firstDayOfMonth = new Date(year, month, 1).getDay();
  for (let i = 0; i < firstDayOfMonth; i++) {
    const empty = document.createElement('div');
    empty.className = 'disabled';
    datesGrid.appendChild(empty);
  }

  // --- 1. GET THE CORRECT LIST (RE-WRITTEN) ---
  // This single block replaces the two separate, complex blocks for
  // getting the challenge string. It's cleaner and handles fallbacks correctly.
  let challengesString = "";

  if (type === "quest") {
      challengesString = userData?.quest_list || userProfileData?.quest_list || userProfileData?.QuestList || "";
  } else if (type === "video") {
      challengesString = userData?.video_list || userProfileData?.video_list || userProfileData?.VideoList || "";
  } else if (type === "story") {
      challengesString = userData?.story_list || userProfileData?.story_list || userProfileData?.StoryList || "";
  }

  // --- 2. NORMALISE THE LIST (done by parseList) ---
  const normalizedList = parseList(challengesString);
  // console.log("â¡ RAW string:", challengesString);
  // console.log("â¡ Normalized List:", normalizedList);

  // --- 3. RENDER DATES ---
  const today = new Date();
  today.setHours(0, 0, 0, 0);

  for (let d = 1; d <= daysInMonth; d++) {
    const currentDate = new Date(year, month, d);

    const diffDays = Math.floor((currentDate - startDate) / (1000 * 60 * 60 * 24));
    const questNumber = diffDays >= 0 ? diffDays + 1 : null;

    const dayDiv = document.createElement('div');

    if (!questNumber) {
    dayDiv.className = 'disabled';
    dayDiv.textContent = d;
    datesGrid.appendChild(dayDiv);
    continue;
}
    // Build the name for matching (e.g., "quest47")
    // ORIGINAL BUG: This block always prefixed "video" or "story"
    // const normalizedType =
    //   type === "quest" ? "quest" :
    //   type === "video" ? "video" :
    //   "story";
    // const normalizedQuestName = `${normalizedType}${questNumber}`;

    // MINIMAL FIX: Conditionally add the prefix ONLY for 'quest'
    let normalizedQuestName;

if (type === 'quest') {
    // Quest format â†’ "quest1"
    normalizedQuestName = `quest${questNumber}`;
}
else if (type === 'video') {
    // Video stored as "Video 1" â†’ becomes "video1"
    normalizedQuestName = `video${questNumber}`;
}
else if (type === 'story') {
    // Story stored as "Story 70" â†’ becomes "story70"
    normalizedQuestName = `story${questNumber}`;
}

    // console.log(
    //   `Date: ${d} | Quest#: ${questNumber} | Check: ${normalizedQuestName} | Completed?`,
    //   normalizedList.includes(normalizedQuestName)
    // );

    const isCompleted = normalizedList.includes(normalizedQuestName);

    // --- Apply Classes ---
    if (isCompleted) {
      dayDiv.className = "done";
      dayDiv.textContent = `${d} ğŸ”¥`;
    } else if (currentDate < today) {
      dayDiv.className = "missed";
      dayDiv.textContent = d;
    } else {
      // This is for today's date if not yet completed
      dayDiv.className = ""; // Today's available quest
      dayDiv.textContent = d;
      // Add a special style for "today"
      dayDiv.style.border = "2px solid #7A0019";
      dayDiv.style.fontWeight = "bold";
    }

    // --- Click Handler ---
    dayDiv.onclick = () => {
      let link = null;

      if (type === "quest") link = questLinks[questNumber];
      else if (type === "video") link = videoLink; // Video link is always the same
      else if (type === "story") link = storyLinks[questNumber];

      if (link) {
        window.location.href = link;
      } else {
        console.warn(`No link found for ${type} ${questNumber}`);
      }
    };

    datesGrid.appendChild(dayDiv);
  }
  // console.groupEnd();
}

async function syncData() {
  if (!userData) return;
 
  const sessionDuration = Math.floor((Date.now() - sessionStartTime) / 1000);
  if (sessionDuration < 10) return; // Don't sync very short sessions
  
  const analyticsData = {
    name: userData.student_name,
    sessionDuration: sessionDuration,
    lastActive: new Date().toISOString(),
    sessionStart: new Date(sessionStartTime).toISOString(),
    isOnline: navigator.onLine,
    department: userProfileData?.Department || userProfileData?.department || 'Unknown'
  };
 
  if (navigator.onLine) {
    try {
      await supabase.from('quest_submissions').insert([
        {
          student_name: analyticsData.name,
          time_spent: analyticsData.sessionDuration,
          quest_id: 'SessionSync',
          department: analyticsData.department
        }
      ]);
    } catch (err) {
      console.error("Error syncing session data:", err);
      savePendingSync(analyticsData); // Save to local if sync fails
    }
  } else {
    savePendingSync(analyticsData);
  }
}

function savePendingSync(data) {
  const pending = JSON.parse(localStorage.getItem('pendingSync') || '[]');
  pending.push(data);
  localStorage.setItem('pendingSync', JSON.stringify(pending));
}

async function handleOnline() {
  document.getElementById('offlineBanner').classList.remove('show');
 
  const pending = JSON.parse(localStorage.getItem('pendingSync') || '[]');
  if (pending.length > 0) {
    console.log(`Syncing ${pending.length} offline sessions...`);
    for (const data of pending) {
        try {
          await supabase.from('quest_submissions').insert([
            {
              student_name: data.name,
              time_spent: data.sessionDuration,
              quest_id: 'OfflineSync',
              department: data.department
            }
          ]);
        } catch (err) {
          console.error("Error submitting pending sync:", err);
        }
    }
    localStorage.removeItem('pendingSync');
  }
 
  // Refresh all data now that we are online
  const savedName = localStorage.getItem('userName');
  if (savedName) refreshData(savedName);
}

function handleOffline() {
  document.getElementById('offlineBanner').classList.add('show');
}

function checkOnlineStatus() {
  if (!navigator.onLine) {
    handleOffline();
  }
}

async function trackInstall() {
  window.addEventListener('beforeinstallprompt', (e) => {
    e.preventDefault();
    console.log('Install prompt captured');
    // We could log this to Supabase, but will wait for actual install
  });
  
  window.addEventListener('appinstalled', async () => {
    const installData = {
      name: localStorage.getItem('userName') || 'Unknown',
      event: 'app_installed',
      timestamp: new Date().toISOString()
    };
    try {
      await supabase.from('quest_submissions').insert([
        {
          student_name: installData.name,
          quest_id: installData.event,
          time_spent: 0,
          department: 'InstallEvent'
        }
      ]);
    } catch (err) {
      console.error('App install tracking error:', err);
    }
  });
}


function logout() {
  showModal('Are you sure you want to logout?', () => {
    syncData(); // Sync one last time
    localStorage.removeItem('userName');
    localStorage.removeItem('cachedUserData');
    localStorage.removeItem('cachedProfileData');
    // localStorage.removeItem('totalTimeSpent'); // This was session time, no longer needed
    window.location.reload();
  });
}
document.addEventListener('DOMContentLoaded', function() {
  const masterSphere = document.getElementById('masterSphere');
  const sphereContainer = document.getElementById('sphereContainer');
  
  if (masterSphere && sphereContainer) {
    masterSphere.addEventListener('click', function(e) {
      e.stopPropagation();
      sphereContainer.classList.toggle('spheres-active');
      masterSphere.classList.toggle('active');
      
      // Haptic feedback (if supported)
      if (navigator.vibrate) {
        navigator.vibrate(50);
      }
    });
    
    // Close on outside click
    document.addEventListener('click', function(e) {
      if (!sphereContainer.contains(e.target)) {
        sphereContainer.classList.remove('spheres-active');
        masterSphere.classList.remove('active');
      }
    });
  }
});
// IMPORTANT: Expose functions to window so HTML onclick attributes can see them
window.saveAndLogin = saveAndLogin;
window.switchType = switchType;
window.changeMonth = changeMonth;
window.toggleDrawer = toggleDrawer;
window.logout = logout;

// Initialize
supabase
  .channel('leaderboard-realtime')
  .on('postgres_changes', { event: '*', schema: 'public', table: 'leaderboard' }, payload => {
    console.log('Leaderboard updated via realtime:', payload);
    const savedName = localStorage.getItem('userName');
    if (savedName) refreshData(savedName); // Refresh data on any change
  })
  .on('postgres_changes', { event: '*', schema: 'public', table: 'summary_import' }, payload => {
    console.log('Summary data updated via realtime:', payload);
    const savedName = localStorage.getItem('userName');
    if (savedName) refreshData(savedName); // Refresh data on any change
  })
  .subscribe();

init();

</script>

<script>
// This script doesn't need module-type, so it's separate.
if ('serviceWorker' in navigator) {
  window.addEventListener('load', () => {
    navigator.serviceWorker.register('service-worker.js')
      .then(reg => console.log('âœ… Service worker registered:', reg.scope))
      .catch(err => console.error('âŒ Service worker registration failed:', err));
  });
}

let deferredPrompt;
window.addEventListener('beforeinstallprompt', (e) => {
  e.preventDefault();
  deferredPrompt = e;
  console.log('ğŸ“² Install prompt captured');

  if (document.getElementById('installPwaBtn')) return;

  const installBtn = document.createElement('button');
  installBtn.id = 'installPwaBtn';
  installBtn.textContent = 'Install App';
 
  Object.assign(installBtn.style, {
    position: 'fixed',
    bottom: '20px',
    right: '20px',
    padding: '12px 20px',
    background: '#7A0019',
    color: 'white',
    border: 'none',
    borderRadius: '10px',
    cursor: 'pointer',
    zIndex: '9999',
    boxShadow: '0 5px 15px rgba(0,0,0,0.3)',
    fontWeight: '600',
    transition: 'transform 0.2s ease'
  });

  installBtn.onmouseover = () => installBtn.style.transform = 'translateY(-2px)';
  installBtn.onmouseout = () => installBtn.style.transform = 'translateY(0)';

  document.body.appendChild(installBtn);

  installBtn.addEventListener('click', async () => {
    installBtn.remove();
    deferredPrompt.prompt();
    const { outcome } = await deferredPrompt.userChoice;
    console.log(`User response: ${outcome}`);
    deferredPrompt = null;
  });
});
</script>

<script>
// Quotes carousel script
const quotes = [
  `"Do or do not. There is no try." <br> â€” Yoda`,
  `"Ever tried. Ever failed. No matter. Try again. Fail again. Fail better." <br> â€” Samuel Beckett`,
  `"The opposite of a profound truth may well be another profound truth." <br> â€” Niels Bohr`,
  `"The opposite of a good idea is another good idea." <br> â€” Rory Sutherland`
];


let qIndex = 0;
setInterval(() => {
  const el = document.getElementById("quotesCarousel");
  if (!el) return;
  el.style.opacity = 0;
  setTimeout(() => {
    qIndex = (qIndex + 1) % quotes.length;
    el.innerHTML = `<p>${quotes[qIndex]}</p>`;
    el.style.opacity = 0.9;
  }, 1000);
}, 5000);
</script>
</body>
</html>
